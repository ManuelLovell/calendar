import{C as k,O as h}from"./constants-22hXSSUW.js";let U={};function ve(o){let r=0;if(o.length===0)return r;for(let d=0;d<o.length;d++){const p=o.charCodeAt(d);r=(r<<5)-r+p,r&=r}return r}function Ce(o){return`hsl(${(ve(o)%360+360)%360}, 70%, 60%)`}function De(o,r,d="CALENDAR"){const p=`${r}_${d}}`,b=U[p];if(b)if(b!==o){const f=new Date(o),u=new Date().getTime()-f.getTime(),T=60*1e3;return u>=T?!0:(U[p]=o,!1)}else return!0;else{const f=new Date(o),u=new Date().getTime()-f.getTime(),T=60*1e3;return u>=T?!0:(U[p]=o,!1)}}function le(o,r){const d=window.matchMedia("(prefers-color-scheme: dark)"),p=d.matches?"dark":"light",b=d.matches?"light":"dark";for(var f=0;f<r.styleSheets.length;f++)for(var w=0;w<r.styleSheets[f].cssRules.length;w++){let u=r.styleSheets[f].cssRules[w];u&&u.media&&u.media.mediaText.includes("prefers-color-scheme")&&(o.mode=="LIGHT"?(u.media.appendMedium(`(prefers-color-scheme: ${p})`),u.media.mediaText.includes(b)&&u.media.deleteMedium(`(prefers-color-scheme: ${b})`)):o.mode=="DARK"&&(u.media.appendMedium(`(prefers-color-scheme: ${b})`),u.media.mediaText.includes(p)&&u.media.deleteMedium(`(prefers-color-scheme: ${p})`)))}}function ye(o,r){if(typeof o!="object"||typeof r!="object")return!1;const d=Object.keys(o),p=Object.keys(r);if(d.length!==p.length)return!1;for(const b of d){const f=o[b],w=r[b];if(typeof f=="object"&&typeof w=="object"){if(!ye(f,w))return!1}else if(f!==w)return!1}return!0}function Ie(){const o=document.createElement("img");o.id="whatsNewButton",o.setAttribute("class","icon"),o.classList.add("clickable"),o.style.marginLeft="10px",o.style.cursor="pointer",o.setAttribute("title","Whats New?"),o.setAttribute("src","/info.svg"),o.onclick=async function(){try{localStorage.setItem(k.VERSION,"true"),o.classList.remove("whats-new-shine")}catch{}await h.modal.open({id:k.EXTENSIONWHATSNEW,url:"/bswhatsnew.html",height:500,width:350})};try{localStorage.getItem(k.VERSION)!=="true"&&o.classList.add("whats-new-shine")}catch{}return o}document.querySelector("#app").innerHTML=`
<div id="floating-header">
  <button id="calendarButton" class="button-selected" (click)="toggleContent('calendar')">Calendar</button>
  <button (click)="toggleContent('months')">Months</button>
  <button (click)="toggleContent('days')">Days</button>
  <button (click)="toggleContent('moons')">Moons</button>
  <button (click)="toggleContent('import')">Import</button>
  <button id="generateCalendar">Generate</button>
  <div id="whatsNew"></div>
</div>

<div id="calendar" class="content">
    <h2 id="titleLine"><div id="spellLevelContainer" style="display:none;"></div><div id="titleName">Calendar!</div><div id="profLevelContainer" style="display:none;"></div></h2>
    <div id="moonContainer"></div>
    <div id="calendarOutput"></div>
</div>

<div id="months" class="content" style="display:none;">
    <label for="calendarName">Calendar Name/Year:</label>
    <input type="text" id="calendarName" name="calendarName" value="Testers">
    </br>
    <label for="currentMonth">Current Month:</label>
    <input type="number" class="input-mini" id="currentMonth" name="currentMonth" value="1">
    </br>
    <label for="numMonths">Number of Months:</label>
    <input type="number" class="input-mini" id="numMonths" name="numMonths" min="1" value="12">
    <div id="monthInputContainer"></div>
</div>

<div id="days" class="content" style="display:none;">
    <label for="startDayYear">Year Begins on WeekDay:</label>
    <input type="number" class="input-mini" id="startDayYear" name="startDayYear" value="1">
    </br>
    <label for="currentDay">Current Day:</label>
    <input type="number" class="input-mini" id="currentDay" name="currentDay" value="1">
    </br>
    <label for="daysPerWeek">Days per Week:</label>
    <input type="number" class="input-mini" id="daysPerWeek" name="daysPerWeek" min="1" value="7">
    <div id="dayNameInputContainer"></div>
        
    <input type="number" style="display: none;" class="input-mini" id="totalDaysInYear" name="totalDaysInYear" min="1" value="365">
</div>

<div id="moons" class="content" style="display:none;">
    <label for="numMoons">Number of Moons:</label>
    <input type="number" class="input-mini" id="numMoons" name="numMoons" min="1" value="1">
    <div id="moonInputContainer"></div>
</div>

<div id="import" class="content" style="display:none;">
    <label for="donjonJson">DonJon Calendar Importer:</label>
    </br>
    <textarea id="donjonJson" rows="20" style="width: 100%;"></textarea>
    </br>
    <button id="importDonJon">Import DonJon Calendar</button>
</div>
<div class="bottom-border"></div>
`;const F=document.getElementById("calendarName"),L=document.getElementById("daysPerWeek"),Z=document.getElementById("startDayYear"),se=document.getElementById("monthInputContainer"),E=document.getElementById("numMonths"),re=document.getElementById("dayNameInputContainer"),ce=document.getElementById("moonInputContainer"),R=document.getElementById("numMoons"),Ne=document.getElementById("generateCalendar"),we=document.getElementById("importDonJon"),ie=document.getElementById("calendarOutput"),de=document.getElementById("calendarButton"),Me=document.getElementById("generateCalendar"),J=document.getElementById("titleName");let Y,H="",q=!1;const Ee=document.getElementById("whatsNew");Ee.appendChild(Ie());let x=1,ue=1;const ee=document.getElementById("spellLevelContainer"),G=document.createElement("div");let $=0;G.textContent="SpellLevel: ";G.classList.add("moon-phase-label");G.style.marginTop="4px";ee?.appendChild(G);const P=document.createElement("input");P.id="spellInput";P.type="number";P.classList.add("moon-mage-stuff");P.onchange=o=>{switch(+o.target.value){case 0:$=0;break;case 1:$=0;break;case 2:$=2;break;case 3:$=4;break;case 4:$=6;break;case 5:$=8;break;default:$=8;break}const p=document.querySelectorAll(".moon-dc-label");for(const b of p){const f=+b.getAttribute("data-dc");b.textContent=`Spell DC: ${(f+$).toString()}`}};ee?.appendChild(P);const te=document.getElementById("profLevelContainer"),V=document.createElement("div");V.textContent="Proficiency: ";V.classList.add("moon-phase-label");V.style.marginTop="4px";te?.appendChild(V);const j=document.createElement("input");j.id="profInput";j.type="number";j.classList.add("moon-mage-stuff");te?.appendChild(j);const me=document.getElementById("moonContainer"),y=document.getElementById("currentDay"),g=document.getElementById("currentMonth");h.onReady(async()=>{const o=await h.theme.getTheme();le(o,document),h.theme.onChange(t=>{le(t,document)});const r=await h.player.getRole(),d=await h.player.getId(),p=await h.room.getMetadata();if(q=p[`${k.EXTENSIONID}/bdOff${d}`],Y=p[`${k.EXTENSIONID}/saveData`],T(),w(),u(),Y&&await K(Y),r==="GM"&&(document.getElementById("calendar").style.height="94%"),r==="PLAYER"){document.getElementById("floating-header").style.display="none",document.getElementById("calendar").style.marginTop="0",document.getElementById("titleLine").style.marginTop="2px",h.room.onMetadataChange(async t=>{const a=t[`${k.EXTENSIONID}/saveData`],n=ye(a,Y);a&&!n&&await K(a),Y=t[`${k.EXTENSIONID}/saveData`]});return}h.room.onMetadataChange(async t=>{const a=t[`${k.OUTSIDEID}/data`];a&&(De(a.Timestamp,"Outside","CALENDAR")||(y.value=(+y.value+ +a.Increment).toString(),await _()))});const b=document.querySelectorAll("#floating-header button"),f=document.querySelectorAll(".content");b.forEach(t=>{t.addEventListener("click",function(){let a=t.textContent?.toLowerCase();a==="generate"&&(a="calendar"),a&&(f.forEach(n=>{n.style.display=n.id===a?"block":"none"}),b.forEach(n=>{n.classList.remove("button-selected")}),t===Me?de.classList.add("button-selected"):t.classList.add("button-selected"))})}),g.onchange=async()=>await _(),y.onchange=async()=>await _(),Ne.onclick=async()=>await ne(),we.onclick=async()=>await K(),L.onchange=()=>u(),R.onchange=()=>T(),E.onchange=()=>w();function w(){se.innerHTML="";for(let t=1;t<=+E.value;t++){const a=document.createElement("div");a.innerHTML=`
            <label for="month${t}Name">Name ${t}:</label>
            <input type="text" id="month${t}Name" name="month${t}Name" value="Month${t}">
    
            <label for="month${t}Days">Days:</label>
            <input type="number" class="input-mini" id="month${t}Days" name="month${t}Days" min="1" value="30">
          `,se.appendChild(a)}}function u(){re.innerHTML="";for(let t=1;t<=+L.value;t++){const a=document.createElement("div");a.innerHTML=`
            <label for="day${t}Name">Day ${t} Name:</label>
            <input type="text" id="day${t}Name" name="day${t}Name" value="Day${t}">
          `,re.appendChild(a)}}function T(){ce.innerHTML="";for(let t=1;t<=+R.value;t++){const a=document.createElement("div");a.innerHTML=`
            <label for="moon${t}Name">Name ${t}:</label>
            <input type="text" class="moon-input" id="moon${t}Name" name="moon${t}Name" value="Moon${t}">
    
            <label for="moon${t}Cycle">Cycle ${t} (days):</label>
            <input type="number" class="input-mini" id="moon${t}Cycle" name="moon${t}Cycle" min="1" value="30">
    
            <label for="moon${t}Shift">Shift ${t}:</label>
            <input type="number" class="input-mini" id="moon${t}Shift" name="moon${t}Shift" min="0" value="0">
          `,ce.appendChild(a)}}function v(t,a,n){return document.getElementById(`${t}${a}${n}`).value}async function ne(){const t=[],a=[];for(let i=1;i<=+E.value;i++){const C=v("month",i,"Name"),I=v("month",i,"Days");t.push(C),a.push(I)}const n=[];for(let i=1;i<=+L.value;i++){const C=v("day",i,"Name");n.push(C)}const l=document.createElement("div");l.classList.add("calendar-system-container");const e=document.createElement("button");e.title="Select Previous Day",e.classList.add("day-back-button"),e.classList.add("clickable"),e.style.background="url(./back-day.svg) no-repeat center center",e.style.backgroundSize="contain",e.onclick=async()=>{y.value=(+y.value-1).toString(),await _()};const s=document.createElement("button");s.title="Select Next Day",s.classList.add("day-forward-button"),s.classList.add("clickable"),s.style.background="url(./forward-day.svg) no-repeat center center",s.style.backgroundSize="contain",s.onclick=async()=>{y.value=(+y.value+1).toString(),await _()};const c=document.createElement("button");c.classList.add("title-line"),c.title="Click to toggle on/off the Day Tag on the Action button.",c.value=q?"OFF":"ON",c.textContent=F.value,c.onclick=async i=>{i.preventDefault(),c.value==="ON"?(await h.action.setBadgeText(void 0),await h.room.setMetadata({[`${k.EXTENSIONID}/bdOff${d}`]:!0}),c.value="OFF"):(await h.action.setBadgeText(H),await h.room.setMetadata({[`${k.EXTENSIONID}/bdOff${d}`]:!1}),c.value="ON")},J.innerHTML="",r==="GM"&&J.appendChild(e),J.appendChild(c),r==="GM"&&J.appendChild(s);const m=parseInt(Z.value),M=parseInt(L.value);let B=m>M?m%M:m,S=!0;for(let i=0;i<+E.value;i++){const C=document.createElement("button");C.title="View previous Month",C.classList.add("mon-back-button"),C.classList.add("clickable"),C.style.background="url(./back-month.svg) no-repeat center center",C.style.backgroundSize="contain",C.onclick=()=>{let N=x-1;N<1&&(N=+E.value),x=N,z()};const I=document.createElement("button");I.title="View next Month",I.classList.add("mon-forward-button"),I.classList.add("clickable"),I.style.background="url(./forward-month.svg) no-repeat center center",I.style.backgroundSize="contain",I.onclick=async()=>{let N=x+1;N>+E.value&&(N=1),x=N,z()};const D=document.createElement("table");D.classList.add("calendar-system"),D.id=`monthTable${i}`;const O=t[i]?t[i]:`Month ${(i+1).toString()}`,ae=D.insertRow();ae.classList.add("month-row");const W=ae.insertCell();W.classList.add("month-header-cell"),W.appendChild(C),W.appendChild(document.createTextNode(O)),W.appendChild(I),W.colSpan=+L.value;const ge=D.insertRow();for(const N of n){const Q=ge.insertCell();Q.textContent=N,Q.classList.add("day-header")}let A=B;for(let N=1;N<=+a[i];N++){if(S){D.insertRow();const be=D.rows[D.rows.length-1];for(let oe=1;oe<A;oe++)be.insertCell();S=!1}else A===1&&D.insertRow();const X=D.rows[D.rows.length-1].insertCell();X.textContent=`${N}`,X.setAttribute("data-month",(i+1).toString()),X.setAttribute("data-day",N.toString()),X.classList.add("day-cell"),A++,A>+L.value&&(A=1)}B=A,S=!0,l.appendChild(D)}ie.innerHTML="",ie.appendChild(l),x=+g.value,await _()}function he(){const t=[];for(let e=1;e<=+L.value;e++){const s=v("day",e,"Name");t.push(s)}const a=[];for(let e=1;e<=+E.value;e++){const s=v("month",e,"Name"),c=v("month",e,"Days");a.push({Name:s,Days:c})}const n=[];for(let e=1;e<=+R.value;e++){const s=v("moon",e,"Name"),c=v("moon",e,"Cycle"),m=v("moon",e,"Shift");n.push({Name:s,Cycle:c,Shift:m})}return{NameYear:F.value,CurrentDay:y.value,StartDayYear:(parseInt(Z.value)-1).toString(),CurrentMonth:g.value,NumberMonth:E.value,DaysPerWeek:L.value,NumberMoons:R.value,MoonSet:n,MonthSet:a,DaySet:t}}function z(t=!1){const a=document.querySelectorAll(".calendar-system");let n=x!==+g.value?x:+g.value;t&&(n=+g.value);let l=ue<n;for(const e of a)e.id===`monthTable${n-1}`?setTimeout(()=>{ue=n,e.style.display="table",e.style.transform=l?"translateX(100%)":"translateX(-100%)",e.offsetHeight,e.style.transform="translateX(0%)",e.style.transition="transform 0.2s ease-in-out"},200):(e.style.transform=l?"translateX(-100%)":"translateX(100%)",e.style.transition="transform 0.2s ease-in-out",setTimeout(()=>{e.style.display="none"},200))}async function _(){const t=v("month",+g.value,"Days");if(+y.value>+t){let e=+g.value+1;e>+E.value?(y.value="1",g.value="1"):(g.value=e.toString(),y.value="1")}else if(+y.value<1){let e=+g.value-1;if(e<1){const s=v("month",+E.value-1,"Days");y.value=s,g.value=E.value}else{const s=v("month",e,"Days");g.value=(+g.value-1).toString(),y.value=s}}document.querySelectorAll(".calendar-system td").forEach(e=>e.classList.remove("current-date"));const n=document.querySelector(`.calendar-system td[data-month="${g.value}"][data-day="${y.value}"]`);n&&n.classList.add("current-date"),z(!0);const l=[];for(let e=1;e<=+R.value;e++){const s=v("moon",e,"Name"),c=v("moon",e,"Cycle"),m=v("moon",e,"Shift");l.push({name:s,cycle:c,shift:m})}me.innerHTML="";for(const e of l){const s=pe(+y.value,+e.cycle,+e.shift,e.name);me.appendChild(s)}if(r==="GM"){const e=he();await h.room.setMetadata({[`${k.EXTENSIONID}/saveData`]:e}),H=`${e?.MonthSet[+e.CurrentMonth-1]?.Name??e?.CurrentMonth}:${e?.CurrentDay}`,q||await h.action.setBadgeText(H)}}function pe(t,a,n,l){const s=(t+n-1)%a/a;let c,m,M;s<.0625||s>=.9375?(c="/new_moon.png",m="New Moon",M="20"):s<.1875?(c="/waxing_crescent.png",m="Waxing Crescent",M="15"):s<.3125?(c="/first_quarter.png",m="First Quarter",M="10"):s<.4375?(c="/waxing_gibbous.png",m="Waxing Gibbous",M="8"):s<.5625?(c="/full_moon.png",m="Full Moon",M="5"):s<.6875?(c="/waning_gibbous.png",m="Waning Gibbous",M="8"):s<.8125?(c="/third_quarter.png",m="Third Quarter",M="10"):(c="/waning_crescent.png",m="Waning Crescent",M="15");let B=Ce(l);switch(l){case"Katamba":B="#000000";break;case"Yavash":B="#FF0000";break;case"Xibar":B="#739BD0";break}const S=document.createElement("div"),i=document.createElement("section");i.classList.add("moon-icon"),i.style.setProperty("--moon-color",B);const C=document.createElement("label");C.textContent=l,C.classList.add("moon-name-label");const I=document.createElement("label");I.textContent=`Spell DC: ${+M+$}`,I.setAttribute("data-dc",M),I.classList.add("moon-dc-label");const D=document.createElement("label");D.textContent=m,D.classList.add("moon-phase-label");const O=document.createElement("img");return O.src=c,O.classList.add("moon-image"),O.title=l,i.appendChild(O),S.appendChild(D),S.appendChild(i),S.appendChild(C),(l==="Xibar"||l==="Katamba"||l==="Yavash")&&(S.appendChild(document.createElement("br")),S.appendChild(I),ee.style.display="block",te.style.display="block"),S}async function K(t){const a=document.getElementById("donjonJson").value;let n;try{t?(n=fe(t),g.value=t.CurrentMonth,y.value=t.CurrentDay):n=JSON.parse(a),F.value=n.year?n.year:"Default Calendar Name",E.value=n.n_months?n.n_months:"12",w();for(let e=1;e<=n.n_months;e++)document.getElementById(`month${e}Name`).value=n.months[e-1]?n.months[e-1]:`DefaultMonth#${e}`,document.getElementById(`month${e}Days`).value=n.month_len[n.months[e-1]]?n.month_len[n.months[e-1]]:"28";document.getElementById("daysPerWeek").value=n.weekdays.length>0?n.weekdays.length:"7",u();for(let e=1;e<=n.weekdays.length;e++)document.getElementById(`day${e}Name`).value=n.weekdays[e-1]?n.weekdays[e-1]:`DefaultDay#${e}`;document.getElementById("numMoons").value=n.n_moons?n.n_moons:"2",T();for(let e=1;e<=n.n_moons;e++)document.getElementById(`moon${e}Name`).value=n.moons[e-1]?n.moons[e-1]:`DefaultMoon#${e}`,document.getElementById(`moon${e}Cycle`).value=n.lunar_cyc[n.moons[e-1]]?n.lunar_cyc[n.moons[e-1]]:"28",document.getElementById(`moon${e}Shift`).value=n.lunar_shf[n.moons[e-1]]?n.lunar_shf[n.moons[e-1]]:"0";document.getElementById("totalDaysInYear").value=n.year_len?n.year_len:"336",Z.value=n.first_day?(parseInt(n.first_day)+1).toString():"1",await ne(),H=`${t?.MonthSet[+t.CurrentMonth-1]?.Name??t?.CurrentMonth}:${t?.CurrentDay}`,q||await h.action.setBadgeText(H),t||(de.click(),await h.notification.show("Calendar Imported Successfully!","SUCCESS"))}catch(l){alert("Invalid Calendar Format."),console.error(l)}}function fe(t){const a={};return a.year=t.NameYear||"Default Calendar Name",a.n_months=t.NumberMonth||"12",a.months=[],a.month_len={},t.MonthSet.forEach((n,l)=>{a.months[l]=n.Name||`DefaultMonth#${l+1}`,a.month_len[a.months[l]]=n.Days||"28"}),a.weekdays=t.DaySet||["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],a.weekdays.forEach((n,l)=>{a.weekdays[l]=n||`DefaultDay#${l+1}`}),a.n_moons=t.NumberMoons||"2",a.moons=[],a.lunar_cyc={},a.lunar_shf={},t.MoonSet.forEach((n,l)=>{a.moons[l]=n.Name||`DefaultMoon#${l+1}`,a.lunar_cyc[a.moons[l]]=n.Cycle||"28",a.lunar_shf[a.moons[l]]=n.Shift||"0"}),a.year_len=t.DaysPerWeek||"336",a.first_day=t.StartDayYear||"0",a}});
