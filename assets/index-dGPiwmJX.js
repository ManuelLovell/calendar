var Xt=Object.defineProperty;var qt=(n,e,t)=>e in n?Xt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ke=(n,e,t)=>(qt(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var x=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class Jt{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return x(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,t){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:t})})}deselect(e){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return x(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return x(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return x(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return x(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return x(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return x(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return x(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:o}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return o.indexOf(e)>-1})}getConnectionId(){return x(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const t=o=>{e(o.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",t)}}}var H=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class Qt{constructor(e){this.messageBus=e}reset(){return H(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return H(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return H(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return H(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return H(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return H(this,void 0,void 0,function*(){const{point:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return t})}inverseTransformPoint(e){return H(this,void 0,void 0,function*(){const{point:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return t})}}function Zt(n){return typeof n.id=="string"}var Ze={exports:{}},le=typeof Reflect=="object"?Reflect:null,lt=le&&typeof le.apply=="function"?le.apply:function(e,t,o){return Function.prototype.apply.call(e,t,o)},Re;le&&typeof le.ownKeys=="function"?Re=le.ownKeys:Object.getOwnPropertySymbols?Re=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Re=function(e){return Object.getOwnPropertyNames(e)};function en(n){console&&console.warn&&console.warn(n)}var Pt=Number.isNaN||function(e){return e!==e};function g(){g.init.call(this)}Ze.exports=g;Ze.exports.once=sn;g.EventEmitter=g;g.prototype._events=void 0;g.prototype._eventsCount=0;g.prototype._maxListeners=void 0;var ft=10;function we(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return ft},set:function(n){if(typeof n!="number"||n<0||Pt(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");ft=n}});g.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};g.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Pt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Gt(n){return n._maxListeners===void 0?g.defaultMaxListeners:n._maxListeners}g.prototype.getMaxListeners=function(){return Gt(this)};g.prototype.emit=function(e){for(var t=[],o=1;o<arguments.length;o++)t.push(arguments[o]);var s=e==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var u=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw u.context=r,u}var l=i[e];if(l===void 0)return!1;if(typeof l=="function")lt(l,this,t);else for(var c=l.length,a=Ht(l,c),o=0;o<c;++o)lt(a[o],this,t);return!0};function kt(n,e,t,o){var s,i,r;if(we(t),i=n._events,i===void 0?(i=n._events=Object.create(null),n._eventsCount=0):(i.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),i=n._events),r=i[e]),r===void 0)r=i[e]=t,++n._eventsCount;else if(typeof r=="function"?r=i[e]=o?[t,r]:[r,t]:o?r.unshift(t):r.push(t),s=Gt(n),s>0&&r.length>s&&!r.warned){r.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=n,u.type=e,u.count=r.length,en(u)}return n}g.prototype.addListener=function(e,t){return kt(this,e,t,!1)};g.prototype.on=g.prototype.addListener;g.prototype.prependListener=function(e,t){return kt(this,e,t,!0)};function tn(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function $t(n,e,t){var o={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},s=tn.bind(o);return s.listener=t,o.wrapFn=s,s}g.prototype.once=function(e,t){return we(t),this.on(e,$t(this,e,t)),this};g.prototype.prependOnceListener=function(e,t){return we(t),this.prependListener(e,$t(this,e,t)),this};g.prototype.removeListener=function(e,t){var o,s,i,r,u;if(we(t),s=this._events,s===void 0)return this;if(o=s[e],o===void 0)return this;if(o===t||o.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,o.listener||t));else if(typeof o!="function"){for(i=-1,r=o.length-1;r>=0;r--)if(o[r]===t||o[r].listener===t){u=o[r].listener,i=r;break}if(i<0)return this;i===0?o.shift():nn(o,i),o.length===1&&(s[e]=o[0]),s.removeListener!==void 0&&this.emit("removeListener",e,u||t)}return this};g.prototype.off=g.prototype.removeListener;g.prototype.removeAllListeners=function(e){var t,o,s;if(o=this._events,o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[e]),this;if(arguments.length===0){var i=Object.keys(o),r;for(s=0;s<i.length;++s)r=i[s],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=o[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this};function Ut(n,e,t){var o=n._events;if(o===void 0)return[];var s=o[e];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?on(s):Ht(s,s.length)}g.prototype.listeners=function(e){return Ut(this,e,!0)};g.prototype.rawListeners=function(e){return Ut(this,e,!1)};g.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):Vt.call(n,e)};g.prototype.listenerCount=Vt;function Vt(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}g.prototype.eventNames=function(){return this._eventsCount>0?Re(this._events):[]};function Ht(n,e){for(var t=new Array(e),o=0;o<e;++o)t[o]=n[o];return t}function nn(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function on(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function sn(n,e){return new Promise(function(t,o){function s(r){n.removeListener(e,i),o(r)}function i(){typeof n.removeListener=="function"&&n.removeListener("error",s),t([].slice.call(arguments))}jt(n,e,i,{once:!0}),e!=="error"&&rn(n,s,{once:!0})})}function rn(n,e,t){typeof n.on=="function"&&jt(n,"error",e,t)}function jt(n,e,t,o){if(typeof n.on=="function")o.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function s(i){o.once&&n.removeEventListener(e,s),t(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var an=Ze.exports;let Te;const cn=new Uint8Array(16);function un(){if(!Te&&(Te=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Te))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Te(cn)}const S=[];for(let n=0;n<256;++n)S.push((n+256).toString(16).slice(1));function dn(n,e=0){return S[n[e+0]]+S[n[e+1]]+S[n[e+2]]+S[n[e+3]]+"-"+S[n[e+4]]+S[n[e+5]]+"-"+S[n[e+6]]+S[n[e+7]]+"-"+S[n[e+8]]+S[n[e+9]]+"-"+S[n[e+10]]+S[n[e+11]]+S[n[e+12]]+S[n[e+13]]+S[n[e+14]]+S[n[e+15]]}const ln=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ht={randomUUID:ln};function fn(n,e,t){if(ht.randomUUID&&!e&&!n)return ht.randomUUID();n=n||{};const o=n.random||(n.rng||un)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=o[s];return e}return dn(o)}class hn extends an.EventEmitter{constructor(e,t){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=o=>{const s=o.data;if(o.origin===this.targetOrigin&&Zt(s)){if(s.id==="OBR_READY"){this.ready=!0;const i=s.data;this.ref=i.ref,this.userId=i.userId}this.emit(s.id,s.data)}},this.send=(o,s,i)=>{var r;if(!this.ref)throw Error("Unable to send message: not ready");(r=window.parent)===null||r===void 0||r.postMessage({id:o,data:s,ref:this.ref,nonce:i},this.targetOrigin)},this.sendAsync=(o,s,i=5e3)=>{const r=`_${fn()}`;return this.send(o,s,r),Promise.race([new Promise((u,l)=>{const c=this;function a(O){c.off(`${o}_RESPONSE${r}`,a),c.off(`${o}_ERROR${r}`,d),u(O)}function d(O){c.off(`${o}_RESPONSE${r}`,a),c.off(`${o}_ERROR${r}`,d),l(O)}this.on(`${o}_RESPONSE${r}`,a),this.on(`${o}_ERROR${r}`,d)}),new Promise((u,l)=>window.setTimeout(()=>l(new Error(`Message ${o} took longer than ${i}ms to get a result`)),i))])},this.roomId=t,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var mt=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class mn{constructor(e){this.messageBus=e}show(e,t){return mt(this,void 0,void 0,function*(){const{id:o}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:t});return o})}close(e){return mt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var re=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class _n{constructor(e){this.messageBus=e}getColor(){return re(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return re(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return re(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return re(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return re(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return re(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const t=o=>{e(o.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",t)}}}var P=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class yn{constructor(e){this.messageBus=e}getDpi(){return P(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return P(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return P(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return P(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return P(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return P(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return P(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,t,o,s){return P(this,void 0,void 0,function*(){const{position:i}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:t,useCorners:o,useCenter:s});return i})}getDistance(e,t){return P(this,void 0,void 0,function*(){const{distance:o}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:t});return o})}onChange(e){const t=o=>{e(o.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",t)}}}var Be=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class En{constructor(e){this.messageBus=e}undo(){return Be(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Be(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Be(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return Be(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function L(n){for(var e=arguments.length,t=Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];throw Error("[Immer] minified error nr: "+n+(t.length?" "+t.map(function(s){return"'"+s+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function oe(n){return!!n&&!!n[$]}function z(n){var e;return!!n&&(function(t){if(!t||typeof t!="object")return!1;var o=Object.getPrototypeOf(t);if(o===null)return!0;var s=Object.hasOwnProperty.call(o,"constructor")&&o.constructor;return s===Object||typeof s=="function"&&Function.toString.call(s)===Cn}(n)||Array.isArray(n)||!!n[ye]||!!(!((e=n.constructor)===null||e===void 0)&&e[ye])||be(n)||Le(n))}function fe(n,e,t){t===void 0&&(t=!1),X(n)===0?(t?Object.keys:rt)(n).forEach(function(o){t&&typeof o=="symbol"||e(o,n[o],n)}):n.forEach(function(o,s){return e(s,o,n)})}function X(n){var e=n[$];return e?e.i>3?e.i-4:e.i:Array.isArray(n)?1:be(n)?2:Le(n)?3:0}function pe(n,e){return X(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function Se(n,e){return X(n)===2?n.get(e):n[e]}function Yt(n,e,t){var o=X(n);o===2?n.set(e,t):o===3?n.add(t):n[e]=t}function pn(n,e){return n===e?n!==0||1/n==1/e:n!=n&&e!=e}function be(n){return Bn&&n instanceof Map}function Le(n){return An&&n instanceof Set}function Z(n){return n.o||n.t}function et(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var e=Rn(n);delete e[$];for(var t=rt(e),o=0;o<t.length;o++){var s=t[o],i=e[s];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(e[s]={configurable:!0,writable:!0,enumerable:i.enumerable,value:n[s]})}return Object.create(Object.getPrototypeOf(n),e)}function tt(n,e){return e===void 0&&(e=!1),nt(n)||oe(n)||!z(n)||(X(n)>1&&(n.set=n.add=n.clear=n.delete=vn),Object.freeze(n),e&&fe(n,function(t,o){return tt(o,!0)},!0)),n}function vn(){L(2)}function nt(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function W(n){var e=qe[n];return e||L(18,n),e}function On(n,e){qe[n]||(qe[n]=e)}function _t(){return ve}function $e(n,e){e&&(W("Patches"),n.u=[],n.s=[],n.v=e)}function Ne(n){Fe(n),n.p.forEach(gn),n.p=null}function Fe(n){n===ve&&(ve=n.l)}function yt(n){return ve={p:[],l:ve,h:n,m:!0,_:0}}function gn(n){var e=n[$];e.i===0||e.i===1?e.j():e.g=!0}function Ue(n,e){e._=e.p.length;var t=e.p[0],o=n!==void 0&&n!==t;return e.h.O||W("ES5").S(e,n,o),o?(t[$].P&&(Ne(e),L(4)),z(n)&&(n=Ie(e,n),e.l||Me(e,n)),e.u&&W("Patches").M(t[$].t,n,e.u,e.s)):n=Ie(e,t,[]),Ne(e),e.u&&e.v(e.u,e.s),n!==it?n:void 0}function Ie(n,e,t){if(nt(e))return e;var o=e[$];if(!o)return fe(e,function(u,l){return Et(n,o,e,u,l,t)},!0),e;if(o.A!==n)return e;if(!o.P)return Me(n,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var s=o.i===4||o.i===5?o.o=et(o.k):o.o,i=s,r=!1;o.i===3&&(i=new Set(s),s.clear(),r=!0),fe(i,function(u,l){return Et(n,o,s,u,l,t,r)}),Me(n,s,!1),t&&n.u&&W("Patches").N(o,t,n.u,n.s)}return o.o}function Et(n,e,t,o,s,i,r){if(oe(s)){var u=Ie(n,s,i&&e&&e.i!==3&&!pe(e.R,o)?i.concat(o):void 0);if(Yt(t,o,u),!oe(u))return;n.m=!1}else r&&t.add(s);if(z(s)&&!nt(s)){if(!n.h.D&&n._<1)return;Ie(n,s),e&&e.A.l||Me(n,s)}}function Me(n,e,t){t===void 0&&(t=!1),!n.l&&n.h.D&&n.m&&tt(e,t)}function Ve(n,e){var t=n[$];return(t?Z(t):n)[e]}function pt(n,e){if(e in n)for(var t=Object.getPrototypeOf(n);t;){var o=Object.getOwnPropertyDescriptor(t,e);if(o)return o;t=Object.getPrototypeOf(t)}}function ze(n){n.P||(n.P=!0,n.l&&ze(n.l))}function He(n){n.o||(n.o=et(n.t))}function Xe(n,e,t){var o=be(e)?W("MapSet").F(e,t):Le(e)?W("MapSet").T(e,t):n.O?function(s,i){var r=Array.isArray(s),u={i:r?1:0,A:i?i.A:_t(),P:!1,I:!1,R:{},l:i,t:s,k:null,o:null,j:null,C:!1},l=u,c=Je;r&&(l=[u],c=_e);var a=Proxy.revocable(l,c),d=a.revoke,O=a.proxy;return u.k=O,u.j=d,O}(e,t):W("ES5").J(e,t);return(t?t.A:_t()).p.push(o),o}function Tn(n){return oe(n)||L(22,n),function e(t){if(!z(t))return t;var o,s=t[$],i=X(t);if(s){if(!s.P&&(s.i<4||!W("ES5").K(s)))return s.t;s.I=!0,o=vt(t,i),s.I=!1}else o=vt(t,i);return fe(o,function(r,u){s&&Se(s.t,r)===u||Yt(o,r,e(u))}),i===3?new Set(o):o}(n)}function vt(n,e){switch(e){case 2:return new Map(n);case 3:return Array.from(n)}return et(n)}function ot(){function n(o){if(!z(o))return o;if(Array.isArray(o))return o.map(n);if(be(o))return new Map(Array.from(o.entries()).map(function(r){return[r[0],n(r[1])]}));if(Le(o))return new Set(Array.from(o).map(n));var s=Object.create(Object.getPrototypeOf(o));for(var i in o)s[i]=n(o[i]);return pe(o,ye)&&(s[ye]=o[ye]),s}function e(o){return oe(o)?n(o):o}var t="add";On("Patches",{$:function(o,s){return s.forEach(function(i){for(var r=i.path,u=i.op,l=o,c=0;c<r.length-1;c++){var a=X(l),d=r[c];typeof d!="string"&&typeof d!="number"&&(d=""+d),a!==0&&a!==1||d!=="__proto__"&&d!=="constructor"||L(24),typeof l=="function"&&d==="prototype"&&L(24),typeof(l=Se(l,d))!="object"&&L(15,r.join("/"))}var O=X(l),p=n(i.value),T=r[r.length-1];switch(u){case"replace":switch(O){case 2:return l.set(T,p);case 3:L(16);default:return l[T]=p}case t:switch(O){case 1:return T==="-"?l.push(p):l.splice(T,0,p);case 2:return l.set(T,p);case 3:return l.add(p);default:return l[T]=p}case"remove":switch(O){case 1:return l.splice(T,1);case 2:return l.delete(T);case 3:return l.delete(i.value);default:return delete l[T]}default:L(17,u)}}),o},N:function(o,s,i,r){switch(o.i){case 0:case 4:case 2:return function(u,l,c,a){var d=u.t,O=u.o;fe(u.R,function(p,T){var A=Se(d,p),D=Se(O,p),f=T?pe(d,p)?"replace":t:"remove";if(A!==D||f!=="replace"){var m=l.concat(p);c.push(f==="remove"?{op:f,path:m}:{op:f,path:m,value:D}),a.push(f===t?{op:"remove",path:m}:f==="remove"?{op:t,path:m,value:e(A)}:{op:"replace",path:m,value:e(A)})}})}(o,s,i,r);case 5:case 1:return function(u,l,c,a){var d=u.t,O=u.R,p=u.o;if(p.length<d.length){var T=[p,d];d=T[0],p=T[1];var A=[a,c];c=A[0],a=A[1]}for(var D=0;D<d.length;D++)if(O[D]&&p[D]!==d[D]){var f=l.concat([D]);c.push({op:"replace",path:f,value:e(p[D])}),a.push({op:"replace",path:f,value:e(d[D])})}for(var m=d.length;m<p.length;m++){var _=l.concat([m]);c.push({op:t,path:_,value:e(p[m])})}d.length<p.length&&a.push({op:"replace",path:l.concat(["length"]),value:d.length})}(o,s,i,r);case 3:return function(u,l,c,a){var d=u.t,O=u.o,p=0;d.forEach(function(T){if(!O.has(T)){var A=l.concat([p]);c.push({op:"remove",path:A,value:T}),a.unshift({op:t,path:A,value:T})}p++}),p=0,O.forEach(function(T){if(!d.has(T)){var A=l.concat([p]);c.push({op:t,path:A,value:T}),a.unshift({op:"remove",path:A,value:T})}p++})}(o,s,i,r)}},M:function(o,s,i,r){i.push({op:"replace",path:[],value:s===it?void 0:s}),r.push({op:"replace",path:[],value:o})}})}var Ot,ve,st=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Bn=typeof Map<"u",An=typeof Set<"u",gt=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",it=st?Symbol.for("immer-nothing"):((Ot={})["immer-nothing"]=!0,Ot),ye=st?Symbol.for("immer-draftable"):"__$immer_draftable",$=st?Symbol.for("immer-state"):"__$immer_state",Cn=""+Object.prototype.constructor,rt=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,Rn=Object.getOwnPropertyDescriptors||function(n){var e={};return rt(n).forEach(function(t){e[t]=Object.getOwnPropertyDescriptor(n,t)}),e},qe={},Je={get:function(n,e){if(e===$)return n;var t=Z(n);if(!pe(t,e))return function(s,i,r){var u,l=pt(i,r);return l?"value"in l?l.value:(u=l.get)===null||u===void 0?void 0:u.call(s.k):void 0}(n,t,e);var o=t[e];return n.I||!z(o)?o:o===Ve(n.t,e)?(He(n),n.o[e]=Xe(n.A.h,o,n)):o},has:function(n,e){return e in Z(n)},ownKeys:function(n){return Reflect.ownKeys(Z(n))},set:function(n,e,t){var o=pt(Z(n),e);if(o!=null&&o.set)return o.set.call(n.k,t),!0;if(!n.P){var s=Ve(Z(n),e),i=s==null?void 0:s[$];if(i&&i.t===t)return n.o[e]=t,n.R[e]=!1,!0;if(pn(t,s)&&(t!==void 0||pe(n.t,e)))return!0;He(n),ze(n)}return n.o[e]===t&&(t!==void 0||e in n.o)||Number.isNaN(t)&&Number.isNaN(n.o[e])||(n.o[e]=t,n.R[e]=!0),!0},deleteProperty:function(n,e){return Ve(n.t,e)!==void 0||e in n.t?(n.R[e]=!1,He(n),ze(n)):delete n.R[e],n.o&&delete n.o[e],!0},getOwnPropertyDescriptor:function(n,e){var t=Z(n),o=Reflect.getOwnPropertyDescriptor(t,e);return o&&{writable:!0,configurable:n.i!==1||e!=="length",enumerable:o.enumerable,value:t[e]}},defineProperty:function(){L(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){L(12)}},_e={};fe(Je,function(n,e){_e[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),_e.deleteProperty=function(n,e){return _e.set.call(this,n,e,void 0)},_e.set=function(n,e,t){return Je.set.call(this,n[0],e,t,n[0])};var Sn=function(){function n(t){var o=this;this.O=gt,this.D=!0,this.produce=function(s,i,r){if(typeof s=="function"&&typeof i!="function"){var u=i;i=s;var l=o;return function(A){var D=this;A===void 0&&(A=u);for(var f=arguments.length,m=Array(f>1?f-1:0),_=1;_<f;_++)m[_-1]=arguments[_];return l.produce(A,function(E){var y;return(y=i).call.apply(y,[D,E].concat(m))})}}var c;if(typeof i!="function"&&L(6),r!==void 0&&typeof r!="function"&&L(7),z(s)){var a=yt(o),d=Xe(o,s,void 0),O=!0;try{c=i(d),O=!1}finally{O?Ne(a):Fe(a)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(A){return $e(a,r),Ue(A,a)},function(A){throw Ne(a),A}):($e(a,r),Ue(c,a))}if(!s||typeof s!="object"){if((c=i(s))===void 0&&(c=s),c===it&&(c=void 0),o.D&&tt(c,!0),r){var p=[],T=[];W("Patches").M(s,c,p,T),r(p,T)}return c}L(21,s)},this.produceWithPatches=function(s,i){if(typeof s=="function")return function(c){for(var a=arguments.length,d=Array(a>1?a-1:0),O=1;O<a;O++)d[O-1]=arguments[O];return o.produceWithPatches(c,function(p){return s.apply(void 0,[p].concat(d))})};var r,u,l=o.produce(s,i,function(c,a){r=c,u=a});return typeof Promise<"u"&&l instanceof Promise?l.then(function(c){return[c,r,u]}):[l,r,u]},typeof(t==null?void 0:t.useProxies)=="boolean"&&this.setUseProxies(t.useProxies),typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=n.prototype;return e.createDraft=function(t){z(t)||L(8),oe(t)&&(t=Tn(t));var o=yt(this),s=Xe(this,t,void 0);return s[$].C=!0,Fe(o),s},e.finishDraft=function(t,o){var s=t&&t[$],i=s.A;return $e(i,o),Ue(void 0,i)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!gt&&L(20),this.O=t},e.applyPatches=function(t,o){var s;for(s=o.length-1;s>=0;s--){var i=o[s];if(i.path.length===0&&i.op==="replace"){t=i.value;break}}s>-1&&(o=o.slice(s+1));var r=W("Patches").$;return oe(t)?r(t,o):this.produce(t,function(u){return r(u,o)})},n}(),U=new Sn;U.produce;var at=U.produceWithPatches.bind(U);U.setAutoFreeze.bind(U);U.setUseProxies.bind(U);U.applyPatches.bind(U);U.createDraft.bind(U);U.finishDraft.bind(U);var ae=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};ot();class Nn{constructor(e){this.messageBus=e}getItems(e){return ae(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return t}else if(e){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return t.filter(e)}else{const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return t}})}isItemArray(e){return Array.isArray(e)&&e.every(t=>typeof t!="string")}updateItems(e,t,o=!0){return ae(this,void 0,void 0,function*(){let s;this.isItemArray(e)?s=e:s=yield this.getItems(e);const[i,r]=at(s,t),u=i.map(l=>({id:l.id,type:l.type}));for(const l of r){const[c,a]=l.path;typeof c=="number"&&typeof a=="string"&&(u[c][a]=i[c][a])}yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:u,updateAttachments:o})})}addItems(e){return ae(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return ae(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return ae(this,void 0,void 0,function*(){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return t})}getItemBounds(e){return ae(this,void 0,void 0,function*(){const{bounds:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return t})}onChange(e){const t=o=>{e(o.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",t)}}}var ce=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};ot();class In{constructor(e){this.messageBus=e}getItems(e){return ce(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return t}else if(e){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return t.filter(e)}else{const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return t}})}updateItems(e,t,o,s=!0){return ce(this,void 0,void 0,function*(){const i=yield this.getItems(e),[r,u]=at(i,t),l=r.map(c=>({id:c.id,type:c.type}));for(const c of u){const[a,d]=c.path;typeof a=="number"&&typeof d=="string"&&(l[a][d]=r[a][d])}yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:l,fastUpdate:o,updateAttachments:s})})}addItems(e){return ce(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return ce(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return ce(this,void 0,void 0,function*(){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return t})}getItemBounds(e){return ce(this,void 0,void 0,function*(){const{bounds:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return t})}onChange(e){const t=o=>{e(o.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",t)}}}var je=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class Mn{constructor(e){this.messageBus=e,this.grid=new yn(e),this.fog=new _n(e),this.history=new En(e),this.items=new Nn(e),this.local=new In(e)}isReady(){return je(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const t=o=>{e(o.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",t)}}getMetadata(){return je(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return je(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const t=o=>{e(o.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",t)}}}function Wt(n){return n.startsWith("http")?n:`${window.location.origin}${n}`}function Ee(n){return n.map(e=>Object.assign(Object.assign({},e),{icon:Wt(e.icon)}))}function ct(n){return Object.assign(Object.assign({},n),{url:Wt(n.url)})}var Tt=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class wn{constructor(e){this.contextMenus={},this.handleClick=t=>{var o;const s=this.contextMenus[t.id];s&&((o=s.onClick)===null||o===void 0||o.call(s,t.context,t.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return Tt(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:Ee(e.icons),embed:e.embed&&ct(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return Tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var Y=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class bn{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=t=>{const o=this.tools[t.id];if(o)if(o.onClick){const s=o.onClick(t.context,t.elementId);Promise.resolve(s).then(i=>{i&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:t.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:t.id})},this.handleToolActionClick=t=>{var o;const s=this.toolActions[t.id];s&&((o=s.onClick)===null||o===void 0||o.call(s,t.context,t.elementId))},this.handleToolModeClick=t=>{const o=this.toolModes[t.id];if(o)if(o.onClick){const s=o.onClick(t.context,t.elementId);Promise.resolve(s).then(i=>{i&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:t.context.activeTool,modeId:t.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:t.context.activeTool,modeId:t.id})},this.handleToolModeToolClick=t=>{const o=this.toolModes[t.id];if(o)if(o.onToolClick){const s=o.onToolClick(t.context,t.event);Promise.resolve(s).then(i=>{i&&t.event.target&&!t.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})})}else t.event.target&&!t.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})},this.handleToolModeToolDoubleClick=t=>{const o=this.toolModes[t.id];if(o)if(o.onToolDoubleClick){const s=o.onToolDoubleClick(t.context,t.event);Promise.resolve(s).then(i=>{i&&t.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})})}else t.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})},this.handleToolModeToolDown=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolDown)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeToolMove=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolMove)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeToolUp=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolUp)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeToolDragStart=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolDragStart)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeToolDragMove=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolDragMove)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeToolDragEnd=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolDragEnd)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeToolDragCancel=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolDragCancel)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeKeyDown=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onKeyDown)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeKeyUp=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onKeyUp)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeActivate=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onActivate)===null||o===void 0||o.call(s,t.context))},this.handleToolModeDeactivate=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onDeactivate)===null||o===void 0||o.call(s,t.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:Ee(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return Y(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return t})}setMetadata(e,t){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:t})})}createAction(e){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:Ee(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:Ee(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,t){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:t})})}}var ue=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class Ln{constructor(e){this.messageBus=e}open(e){return ue(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},ct(e)))})}close(e){return ue(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return ue(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return t})}setWidth(e,t){return ue(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:t})})}getHeight(e){return ue(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return t})}setHeight(e,t){return ue(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:t})})}}var Bt=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class Dn{constructor(e){this.messageBus=e}open(e){return Bt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},ct(e)))})}close(e){return Bt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var G=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class xn{constructor(e){this.messageBus=e}getWidth(){return G(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return G(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return G(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return G(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return G(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return G(this,void 0,void 0,function*(){const t=Ee([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:t[0].icon})})}getTitle(){return G(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return G(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const t=o=>{e(o.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",t)}}}var Pn=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};ot();class Gn{constructor(e){this.messageBus=e}startItemInteraction(e,t=!0){return Pn(this,void 0,void 0,function*(){const{id:o}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e,updateAttachments:t});let s=e;return[u=>{const[l,c]=at(s,u);return s=l,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:o,patches:c}),l},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:o})}]})}}var kn=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class $n{constructor(e){this.messageBus=e}getPlayers(){return kn(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const t=o=>{e(o.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",t)}}}var Ye=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class Un{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return Ye(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return Ye(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return Ye(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const t=o=>{e(o.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",t)}}onPermissionsChange(e){const t=o=>{e(o.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",t)}}}var Vn=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class Hn{constructor(e){this.messageBus=e}getTheme(){return Vn(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const t=o=>{e(o.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",t)}}}var At=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function u(a){try{c(o.next(a))}catch(d){r(d)}}function l(a){try{c(o.throw(a))}catch(d){r(d)}}function c(a){a.done?i(a.value):s(a.value).then(u,l)}c((o=o.apply(n,e||[])).next())})};class jn{constructor(e){this.messageBus=e}uploadImages(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e})})}uploadScenes(e){return At(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e})})}}const Yn=typeof atob=="function",ut=typeof Buffer=="function",Ct=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const Wn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Kn=Array.prototype.slice.call(Wn),Ae=(n=>{let e={};return n.forEach((t,o)=>e[t]=o),e})(Kn),Fn=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,ee=String.fromCharCode.bind(String),Rt=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),Kt=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),zn=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Xn=n=>{switch(n.length){case 4:var e=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),t=e-65536;return ee((t>>>10)+55296)+ee((t&1023)+56320);case 3:return ee((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return ee((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},qn=n=>n.replace(zn,Xn),Jn=n=>{if(n=n.replace(/\s+/g,""),!Fn.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let e,t="",o,s;for(let i=0;i<n.length;)e=Ae[n.charAt(i++)]<<18|Ae[n.charAt(i++)]<<12|(o=Ae[n.charAt(i++)])<<6|(s=Ae[n.charAt(i++)]),t+=o===64?ee(e>>16&255):s===64?ee(e>>16&255,e>>8&255):ee(e>>16&255,e>>8&255,e&255);return t},Ft=Yn?n=>atob(Kt(n)):ut?n=>Buffer.from(n,"base64").toString("binary"):Jn,Qn=ut?n=>Rt(Buffer.from(n,"base64")):n=>Rt(Ft(n).split("").map(e=>e.charCodeAt(0))),Zn=ut?n=>Buffer.from(n,"base64").toString("utf8"):Ct?n=>Ct.decode(Qn(n)):n=>qn(Ft(n)),eo=n=>Kt(n.replace(/[-_]/g,e=>e=="-"?"+":"/")),to=n=>Zn(eo(n));function no(){const e=new URLSearchParams(window.location.search).get("obrref");let t="",o="";if(e){const i=to(e).split(" ");i.length===2&&(t=i[0],o=i[1])}return{origin:t,roomId:o}}var St;(function(n){n[n.MOVE=0]="MOVE",n[n.LINE=1]="LINE",n[n.QUAD=2]="QUAD",n[n.CONIC=3]="CONIC",n[n.CUBIC=4]="CUBIC",n[n.CLOSE=5]="CLOSE"})(St||(St={}));const Qe=no(),N=new hn(Qe.origin,Qe.roomId),oo=new Qt(N),so=new Jt(N),io=new $n(N),ro=new mn(N),ao=new Mn(N),co=new wn(N),uo=new bn(N),lo=new Ln(N),fo=new Dn(N),ho=new xn(N),mo=new Gn(N),_o=new Un(N),yo=new Hn(N),Eo=new jn(N),j={onReady:n=>{N.ready?n():N.once("OBR_READY",()=>n())},get isReady(){return N.ready},viewport:oo,player:so,party:io,notification:ro,scene:ao,contextMenu:co,tool:uo,popover:lo,modal:fo,action:ho,interaction:mo,room:_o,theme:yo,assets:Eo,isAvailable:!!Qe.origin};let We={};function po(n){let e=0;if(n.length===0)return e;for(let t=0;t<n.length;t++){const o=n.charCodeAt(t);e=(e<<5)-e+o,e&=e}return e}function vo(n){return`hsl(${(po(n)%360+360)%360}, 70%, 60%)`}function Oo(n,e,t="CALENDAR"){const o=`${e}_${t}}`,s=We[o];if(s)if(s!==n){const i=new Date(n),u=new Date().getTime()-i.getTime(),l=60*1e3;return u>=l?!0:(We[o]=n,!1)}else return!0;else{const i=new Date(n),u=new Date().getTime()-i.getTime(),l=60*1e3;return u>=l?!0:(We[o]=n,!1)}}function Nt(n,e){const t=window.matchMedia("(prefers-color-scheme: dark)"),o=t.matches?"dark":"light",s=t.matches?"light":"dark";for(var i=0;i<e.styleSheets.length;i++)for(var r=0;r<e.styleSheets[i].cssRules.length;r++){let u=e.styleSheets[i].cssRules[r];u&&u.media&&u.media.mediaText.includes("prefers-color-scheme")&&(n.mode=="LIGHT"?(u.media.appendMedium(`(prefers-color-scheme: ${o})`),u.media.mediaText.includes(s)&&u.media.deleteMedium(`(prefers-color-scheme: ${s})`)):n.mode=="DARK"&&(u.media.appendMedium(`(prefers-color-scheme: ${s})`),u.media.mediaText.includes(o)&&u.media.deleteMedium(`(prefers-color-scheme: ${o})`)))}}class de{}ke(de,"EXTENSIONID","com.battle-system.calendar"),ke(de,"OUTSIDEID","com.battle-system.calendar-integrate");document.querySelector("#app").innerHTML=`
<div id="floating-header">
  <button id="calendarButton" class="button-selected" (click)="toggleContent('calendar')">Calendar</button>
  <button (click)="toggleContent('months')">Months</button>
  <button (click)="toggleContent('days')">Days</button>
  <button (click)="toggleContent('moons')">Moons</button>
  <button (click)="toggleContent('import')">Import</button>
  <button id="generateCalendar">Generate</button>
</div>

<div id="calendar" class="content">
    <h2 id="titleLine"><div id="spellLevelContainer" style="display:none;"></div><div id="titleName">Calendar!</div><div id="profLevelContainer" style="display:none;"></div></h2>
    <div id="moonContainer"></div>
    <div id="calendarOutput"></div>
</div>

<div id="months" class="content" style="display:none;">
    <label for="calendarName">Calendar Name/Year:</label>
    <input type="text" id="calendarName" name="calendarName" value="Testers">
    </br>
    <label for="currentMonth">Current Month:</label>
    <input type="number" class="input-mini" id="currentMonth" name="currentMonth" value="1">
    </br>
    <label for="numMonths">Number of Months:</label>
    <input type="number" class="input-mini" id="numMonths" name="numMonths" min="1" value="12">
    <div id="monthInputContainer"></div>
</div>

<div id="days" class="content" style="display:none;">
    <label for="currentDay">Current Day:</label>
    <input type="number" class="input-mini" id="currentDay" name="currentDay" value="1">
    </br>
    <label for="daysPerWeek">Days per Week:</label>
    <input type="number" class="input-mini" id="daysPerWeek" name="daysPerWeek" min="1" value="7">
    <div id="dayNameInputContainer"></div>
        
    <input type="number" style="display: none;" class="input-mini" id="totalDaysInYear" name="totalDaysInYear" min="1" value="365">
</div>

<div id="moons" class="content" style="display:none;">
    <label for="numMoons">Number of Moons:</label>
    <input type="number" class="input-mini" id="numMoons" name="numMoons" min="1" value="1">
    <div id="moonInputContainer"></div>
</div>

<div id="import" class="content" style="display:none;">
    <label for="donjonJson">DonJon Calendar Importer:</label>
    </br>
    <textarea id="donjonJson" rows="20" style="width: 100%;"></textarea>
    </br>
    <button id="importDonJon">Import DonJon Calendar</button>
</div>
<div class="bottom-border"></div>
`;const Ke=document.getElementById("calendarName"),J=document.getElementById("daysPerWeek"),It=document.getElementById("monthInputContainer"),V=document.getElementById("numMonths"),Mt=document.getElementById("dayNameInputContainer"),wt=document.getElementById("moonInputContainer"),me=document.getElementById("numMoons"),go=document.getElementById("generateCalendar"),To=document.getElementById("importDonJon"),bt=document.getElementById("calendarOutput"),Lt=document.getElementById("calendarButton"),Bo=document.getElementById("generateCalendar"),Ce=document.getElementById("titleName");let Q=1,Dt=1;const te=document.getElementById("spellLevelContainer"),De=document.createElement("div");let F=0;De.textContent="SpellLevel: ";De.classList.add("moon-phase-label");De.style.marginTop="4px";te==null||te.appendChild(De);const Oe=document.createElement("input");Oe.id="spellInput";Oe.type="number";Oe.classList.add("moon-mage-stuff");Oe.onchange=n=>{switch(+n.target.value){case 0:F=0;break;case 1:F=0;break;case 2:F=2;break;case 3:F=4;break;case 4:F=6;break;case 5:F=8;break;default:F=8;break}const o=document.querySelectorAll(".moon-dc-label");for(const s of o){const i=+s.getAttribute("data-dc");s.textContent=`Spell DC: ${(i+F).toString()}`}};te==null||te.appendChild(Oe);const ne=document.getElementById("profLevelContainer"),xe=document.createElement("div");xe.textContent="Proficiency: ";xe.classList.add("moon-phase-label");xe.style.marginTop="4px";ne==null||ne.appendChild(xe);const Pe=document.createElement("input");Pe.id="profInput";Pe.type="number";Pe.classList.add("moon-mage-stuff");ne==null||ne.appendChild(Pe);const xt=document.getElementById("moonContainer"),R=document.getElementById("currentDay"),b=document.getElementById("currentMonth");j.onReady(async()=>{const n=await j.theme.getTheme();Nt(n,document),j.theme.onChange(f=>{Nt(f,document)});const e=await j.player.getRole(),o=(await j.room.getMetadata())[`${de.EXTENSIONID}/saveData`];if(l(),r(),u(),o&&await A(o),e==="GM"&&(document.getElementById("calendar").style.height="94%"),e==="PLAYER"){document.getElementById("floating-header").style.display="none",document.getElementById("calendar").style.marginTop="0",document.getElementById("titleLine").style.marginTop="2px",j.room.onMetadataChange(async f=>{const m=f[`${de.EXTENSIONID}/saveData`];m&&await A(m)});return}j.room.onMetadataChange(async f=>{const m=f[`${de.OUTSIDEID}/data`];m&&(Oo(m.Timestamp,"Outside","CALENDAR")||(R.value=(+R.value+ +m.Increment).toString(),await p()))});const s=document.querySelectorAll("#floating-header button"),i=document.querySelectorAll(".content");s.forEach(f=>{f.addEventListener("click",function(){var _;let m=(_=f.textContent)==null?void 0:_.toLowerCase();m==="generate"&&(m="calendar"),m&&(i.forEach(E=>{E.style.display=E.id===m?"block":"none"}),s.forEach(E=>{E.classList.remove("button-selected")}),f===Bo?Lt.classList.add("button-selected"):f.classList.add("button-selected"))})}),b.onchange=async()=>await p(),R.onchange=async()=>await p(),go.onclick=async()=>await a(),To.onclick=async()=>await A(),J.onchange=()=>u(),me.onchange=()=>l(),V.onchange=()=>r();function r(){It.innerHTML="";for(let f=1;f<=+V.value;f++){const m=document.createElement("div");m.innerHTML=`
            <label for="month${f}Name">Name ${f}:</label>
            <input type="text" id="month${f}Name" name="month${f}Name" value="Month${f}">
    
            <label for="month${f}Days">Days:</label>
            <input type="number" class="input-mini" id="month${f}Days" name="month${f}Days" min="1" value="30">
          `,It.appendChild(m)}}function u(){Mt.innerHTML="";for(let f=1;f<=+J.value;f++){const m=document.createElement("div");m.innerHTML=`
            <label for="day${f}Name">Day ${f} Name:</label>
            <input type="text" id="day${f}Name" name="day${f}Name" value="Day${f}">
          `,Mt.appendChild(m)}}function l(){wt.innerHTML="";for(let f=1;f<=+me.value;f++){const m=document.createElement("div");m.innerHTML=`
            <label for="moon${f}Name">Name ${f}:</label>
            <input type="text" class="moon-input" id="moon${f}Name" name="moon${f}Name" value="Moon${f}">
    
            <label for="moon${f}Cycle">Cycle ${f} (days):</label>
            <input type="number" class="input-mini" id="moon${f}Cycle" name="moon${f}Cycle" min="1" value="30">
    
            <label for="moon${f}Shift">Shift ${f}:</label>
            <input type="number" class="input-mini" id="moon${f}Shift" name="moon${f}Shift" min="0" value="0">
          `,wt.appendChild(m)}}function c(f,m,_){return document.getElementById(`${f}${m}${_}`).value}async function a(){const f=[],m=[];for(let v=1;v<=+V.value;v++){const I=c("month",v,"Name"),M=c("month",v,"Days");f.push(I),m.push(M)}const _=[];for(let v=1;v<=+J.value;v++){const I=c("day",v,"Name");_.push(I)}const E=document.createElement("div");E.classList.add("calendar-system-container");const y=document.createElement("button");y.title="Select Previous Day",y.classList.add("day-back-button"),y.classList.add("clickable"),y.style.background="url(./back-day.svg) no-repeat center center",y.style.backgroundSize="contain",y.onclick=async()=>{R.value=(+R.value-1).toString(),await p()};const h=document.createElement("button");h.title="Select Next Day",h.classList.add("day-forward-button"),h.classList.add("clickable"),h.style.background="url(./forward-day.svg) no-repeat center center",h.style.backgroundSize="contain",h.onclick=async()=>{R.value=(+R.value+1).toString(),await p()},Ce.innerHTML="",e==="GM"&&Ce.appendChild(y),Ce.appendChild(document.createTextNode(Ke.value)),e==="GM"&&Ce.appendChild(h);let B=1,C=!0;for(let v=0;v<+V.value;v++){const I=document.createElement("button");I.title="View previous Month",I.classList.add("mon-back-button"),I.classList.add("clickable"),I.style.background="url(./back-month.svg) no-repeat center center",I.style.backgroundSize="contain",I.onclick=()=>{let k=Q-1;k<1&&(k=+V.value),Q=k,O()};const M=document.createElement("button");M.title="View next Month",M.classList.add("mon-forward-button"),M.classList.add("clickable"),M.style.background="url(./forward-month.svg) no-repeat center center",M.style.backgroundSize="contain",M.onclick=async()=>{let k=Q+1;k>+V.value&&(k=1),Q=k,O()};const w=document.createElement("table");w.classList.add("calendar-system"),w.id=`monthTable${v}`;const he=f[v]?f[v]:`Month ${(v+1).toString()}`,q=w.insertRow();q.classList.add("month-row");const K=q.insertCell();K.classList.add("month-header-cell"),K.appendChild(I),K.appendChild(document.createTextNode(he)),K.appendChild(M),K.colSpan=+J.value;const se=w.insertRow();for(const k of _){const Ge=se.insertCell();Ge.textContent=k,Ge.classList.add("day-header")}let ie=B;for(let k=1;k<=+m[v];k++){if(C){w.insertRow();const zt=w.rows[w.rows.length-1];for(let dt=1;dt<ie;dt++)zt.insertCell();C=!1}else ie===1&&w.insertRow();const ge=w.rows[w.rows.length-1].insertCell();ge.textContent=`${k}`,ge.setAttribute("data-month",(v+1).toString()),ge.setAttribute("data-day",k.toString()),ge.classList.add("day-cell"),ie++,ie>+J.value&&(ie=1)}B=ie,C=!0,E.appendChild(w)}bt.innerHTML="",bt.appendChild(E),Q=+b.value,await p()}function d(){const f=[];for(let y=1;y<=+J.value;y++){const h=c("day",y,"Name");f.push(h)}const m=[];for(let y=1;y<=+V.value;y++){const h=c("month",y,"Name"),B=c("month",y,"Days");m.push({Name:h,Days:B})}const _=[];for(let y=1;y<=+me.value;y++){const h=c("moon",y,"Name"),B=c("moon",y,"Cycle"),C=c("moon",y,"Shift");_.push({Name:h,Cycle:B,Shift:C})}return{NameYear:Ke.value,CurrentDay:R.value,CurrentMonth:b.value,NumberMonth:V.value,DaysPerWeek:J.value,NumberMoons:me.value,MoonSet:_,MonthSet:m,DaySet:f}}function O(f=!1){const m=document.querySelectorAll(".calendar-system");let _=Q!==+b.value?Q:+b.value;f&&(_=+b.value);let E=Dt<_;for(const y of m)y.id===`monthTable${_-1}`?setTimeout(()=>{Dt=_,y.style.display="table",y.style.transform=E?"translateX(100%)":"translateX(-100%)",y.offsetHeight,y.style.transform="translateX(0%)",y.style.transition="transform 0.2s ease-in-out"},200):(y.style.transform=E?"translateX(-100%)":"translateX(100%)",y.style.transition="transform 0.2s ease-in-out",setTimeout(()=>{y.style.display="none"},200))}async function p(){var y;const f=c("month",+b.value,"Days");if(+R.value>+f){let h=+b.value+1;h>+V.value?(R.value="1",b.value="1"):(b.value=h.toString(),R.value="1")}else if(+R.value<1){let h=+b.value-1;if(h<1){const B=c("month",+V.value-1,"Days");R.value=B,b.value=V.value}else{const B=c("month",h,"Days");b.value=(+b.value-1).toString(),R.value=B}}document.querySelectorAll(".calendar-system td").forEach(h=>h.classList.remove("current-date"));const _=document.querySelector(`.calendar-system td[data-month="${b.value}"][data-day="${R.value}"]`);_&&_.classList.add("current-date"),O(!0);const E=[];for(let h=1;h<=+me.value;h++){const B=c("moon",h,"Name"),C=c("moon",h,"Cycle"),v=c("moon",h,"Shift");E.push({name:B,cycle:C,shift:v})}xt.innerHTML="";for(const h of E){const B=T(+R.value,+h.cycle,+h.shift,h.name);xt.appendChild(B)}if(e==="GM"){const h=d();await j.room.setMetadata({[`${de.EXTENSIONID}/saveData`]:h});const B=(y=h==null?void 0:h.MonthSet[+h.CurrentMonth-1])==null?void 0:y.Name;await j.action.setBadgeText(`${B??(h==null?void 0:h.CurrentMonth)}:${h==null?void 0:h.CurrentDay}`)}}function T(f,m,_,E){const h=(f+_-1)%m/m;let B,C,v;h<.0625||h>=.9375?(B="/new_moon.png",C="New Moon",v="20"):h<.1875?(B="/waxing_crescent.png",C="Waxing Crescent",v="15"):h<.3125?(B="/first_quarter.png",C="First Quarter",v="10"):h<.4375?(B="/waxing_gibbous.png",C="Waxing Gibbous",v="8"):h<.5625?(B="/full_moon.png",C="Full Moon",v="5"):h<.6875?(B="/waning_gibbous.png",C="Waning Gibbous",v="8"):h<.8125?(B="/third_quarter.png",C="Third Quarter",v="10"):(B="/waning_crescent.png",C="Waning Crescent",v="15");let I=vo(E);switch(E){case"Katamba":I="#000000";break;case"Yavash":I="#FF0000";break;case"Xibar":I="#739BD0";break}const M=document.createElement("div"),w=document.createElement("section");w.classList.add("moon-icon"),w.style.setProperty("--moon-color",I);const he=document.createElement("label");he.textContent=E,he.classList.add("moon-name-label");const q=document.createElement("label");q.textContent=`Spell DC: ${+v+F}`,q.setAttribute("data-dc",v),q.classList.add("moon-dc-label");const K=document.createElement("label");K.textContent=C,K.classList.add("moon-phase-label");const se=document.createElement("img");return se.src=B,se.classList.add("moon-image"),se.title=E,w.appendChild(se),M.appendChild(K),M.appendChild(w),M.appendChild(he),(E==="Xibar"||E==="Katamba"||E==="Yavash")&&(M.appendChild(document.createElement("br")),M.appendChild(q),te.style.display="block",ne.style.display="block"),M}async function A(f){var E;const m=document.getElementById("donjonJson").value;let _;try{f?(_=D(f),b.value=f.CurrentMonth,R.value=f.CurrentDay):_=JSON.parse(m),Ke.value=_.year?_.year:"Default Calendar Name",V.value=_.n_months?_.n_months:"12",r();for(let h=1;h<=_.n_months;h++)document.getElementById(`month${h}Name`).value=_.months[h-1]?_.months[h-1]:`DefaultMonth#${h}`,document.getElementById(`month${h}Days`).value=_.month_len[_.months[h-1]]?_.month_len[_.months[h-1]]:"28";document.getElementById("daysPerWeek").value=_.weekdays.length>0?_.weekdays.length:"7",u();for(let h=1;h<=_.weekdays.length;h++)document.getElementById(`day${h}Name`).value=_.weekdays[h-1]?_.weekdays[h-1]:`DefaultDay#${h}`;document.getElementById("numMoons").value=_.n_moons?_.n_moons:"2",l();for(let h=1;h<=_.n_moons;h++)document.getElementById(`moon${h}Name`).value=_.moons[h-1]?_.moons[h-1]:`DefaultMoon#${h}`,document.getElementById(`moon${h}Cycle`).value=_.lunar_cyc[_.moons[h-1]]?_.lunar_cyc[_.moons[h-1]]:"28",document.getElementById(`moon${h}Shift`).value=_.lunar_shf[_.moons[h-1]]?_.lunar_shf[_.moons[h-1]]:"0";document.getElementById("totalDaysInYear").value=_.year_len?_.year_len:"336",await a();const y=(E=f==null?void 0:f.MonthSet[+f.CurrentMonth-1])==null?void 0:E.Name;await j.action.setBadgeText(`${y??(f==null?void 0:f.CurrentMonth)}:${f==null?void 0:f.CurrentDay}`),f||(Lt.click(),await j.notification.show("Calendar Imported Successfully!","SUCCESS"))}catch(y){alert("Invalid Calendar Format."),console.error(y)}}function D(f){const m={};return m.year=f.NameYear||"Default Calendar Name",m.n_months=f.NumberMonth||"12",m.months=[],m.month_len={},f.MonthSet.forEach((_,E)=>{m.months[E]=_.Name||`DefaultMonth#${E+1}`,m.month_len[m.months[E]]=_.Days||"28"}),m.weekdays=f.DaySet||["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],m.weekdays.forEach((_,E)=>{m.weekdays[E]=_||`DefaultDay#${E+1}`}),m.n_moons=f.NumberMoons||"2",m.moons=[],m.lunar_cyc={},m.lunar_shf={},f.MoonSet.forEach((_,E)=>{m.moons[E]=_.Name||`DefaultMoon#${E+1}`,m.lunar_cyc[m.moons[E]]=_.Cycle||"28",m.lunar_shf[m.moons[E]]=_.Shift||"0"}),m.year_len=f.DaysPerWeek||"336",m}});
