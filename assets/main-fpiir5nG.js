import{C as $,O as h}from"./constants-_ZGqeghE.js";let Z={};function ve(o){let s=0;if(o.length===0)return s;for(let d=0;d<o.length;d++){const p=o.charCodeAt(d);s=(s<<5)-s+p,s&=s}return s}function Ce(o){return`hsl(${(ve(o)%360+360)%360}, 70%, 60%)`}function De(o,s,d="CALENDAR"){const p=`${s}_${d}}`,C=Z[p];if(C)if(C!==o){const f=new Date(o),u=new Date().getTime()-f.getTime(),_=60*1e3;return u>=_?!0:(Z[p]=o,!1)}else return!0;else{const f=new Date(o),u=new Date().getTime()-f.getTime(),_=60*1e3;return u>=_?!0:(Z[p]=o,!1)}}function se(o,s){const d=window.matchMedia("(prefers-color-scheme: dark)"),p=d.matches?"dark":"light",C=d.matches?"light":"dark";for(var f=0;f<s.styleSheets.length;f++)for(var M=0;M<s.styleSheets[f].cssRules.length;M++){let u=s.styleSheets[f].cssRules[M];u&&u.media&&u.media.mediaText.includes("prefers-color-scheme")&&(o.mode=="LIGHT"?(u.media.appendMedium(`(prefers-color-scheme: ${p})`),u.media.mediaText.includes(C)&&u.media.deleteMedium(`(prefers-color-scheme: ${C})`)):o.mode=="DARK"&&(u.media.appendMedium(`(prefers-color-scheme: ${C})`),u.media.mediaText.includes(p)&&u.media.deleteMedium(`(prefers-color-scheme: ${p})`)))}}function he(o,s){if(typeof o!="object"||typeof s!="object")return!1;const d=Object.keys(o),p=Object.keys(s);if(d.length!==p.length)return!1;for(const C of d){const f=o[C],M=s[C];if(typeof f=="object"&&typeof M=="object"){if(!he(f,M))return!1}else if(f!==M)return!1}return!0}function Ie(){const o=document.createElement("img");o.id="whatsNewButton",o.setAttribute("class","icon"),o.classList.add("clickable"),o.style.marginLeft="10px",o.style.cursor="pointer",o.setAttribute("title","Whats New?"),o.setAttribute("src","/info.svg"),o.onclick=async function(){try{localStorage.setItem($.VERSION,"true"),o.classList.remove("whats-new-shine")}catch{}await h.modal.open({id:$.EXTENSIONWHATSNEW,url:"/bswhatsnew.html",height:500,width:350})};try{localStorage.getItem($.VERSION)!=="true"&&o.classList.add("whats-new-shine")}catch{}return o}document.querySelector("#app").innerHTML=`
<div id="floating-header">
  <button id="calendarButton" class="button-selected" (click)="toggleContent('calendar')">Calendar</button>
  <button (click)="toggleContent('months')">Months</button>
  <button (click)="toggleContent('days')">Days</button>
  <button (click)="toggleContent('moons')">Moons</button>
  <button (click)="toggleContent('import')">Import</button>
  <button id="generateCalendar">Generate</button>
  <div id="whatsNew"></div>
</div>

<div id="calendar" class="content">
    <h2 id="titleLine"><div id="spellLevelContainer" style="display:none;"></div><div id="titleName">Calendar!</div><div id="profLevelContainer" style="display:none;"></div></h2>
    <div id="moonContainer"></div>
    <div id="calendarOutput"></div>
</div>

<div id="months" class="content" style="display:none;">
    <label for="calendarName">Calendar Name/Year:</label>
    <input type="text" id="calendarName" name="calendarName" value="Testers">
    </br>
    <label for="currentMonth">Current Month:</label>
    <input type="number" class="input-mini" id="currentMonth" name="currentMonth" value="1">
    </br>
    <label for="numMonths">Number of Months:</label>
    <input type="number" class="input-mini" id="numMonths" name="numMonths" min="1" value="12">
    <div id="monthInputContainer"></div>
</div>

<div id="days" class="content" style="display:none;">
    <label for="startDayYear">Year Begins on WeekDay:</label>
    <input type="number" class="input-mini" id="startDayYear" name="startDayYear" value="1">
    </br>
    <label for="currentDay">Current Day:</label>
    <input type="number" class="input-mini" id="currentDay" name="currentDay" value="1">
    </br>
    <label for="daysPerWeek">Days per Week:</label>
    <input type="number" class="input-mini" id="daysPerWeek" name="daysPerWeek" min="1" value="7">
    <div id="dayNameInputContainer"></div>
        
    <input type="number" style="display: none;" class="input-mini" id="totalDaysInYear" name="totalDaysInYear" min="1" value="365">
</div>

<div id="moons" class="content" style="display:none;">
    <label for="numMoons">Number of Moons:</label>
    <input type="number" class="input-mini" id="numMoons" name="numMoons" min="1" value="1">
    <div id="moonInputContainer"></div>
</div>

<div id="import" class="content" style="display:none;">
    <label for="donjonJson">DonJon Calendar Importer:</label>
    </br>
    <textarea id="donjonJson" rows="20" style="width: 100%;"></textarea>
    </br>
    <button id="importDonJon">Import DonJon Calendar</button>
</div>
<div class="bottom-border"></div>
`;const ee=document.getElementById("calendarName"),x=document.getElementById("daysPerWeek"),te=document.getElementById("startDayYear"),re=document.getElementById("monthInputContainer"),S=document.getElementById("numMonths"),ce=document.getElementById("dayNameInputContainer"),ie=document.getElementById("moonInputContainer"),H=document.getElementById("numMoons"),Ne=document.getElementById("generateCalendar"),we=document.getElementById("importDonJon"),de=document.getElementById("calendarOutput"),ue=document.getElementById("calendarButton"),Me=document.getElementById("generateCalendar"),G=document.getElementById("titleName");let P,X="",V=!1;const Ee=document.getElementById("whatsNew");Ee.appendChild(Ie());let O=1,me=1;const ne=document.getElementById("spellLevelContainer"),j=document.createElement("div");let L=0;j.textContent="SpellLevel: ";j.classList.add("moon-phase-label");j.style.marginTop="4px";ne?.appendChild(j);const J=document.createElement("input");J.id="spellInput";J.type="number";J.classList.add("moon-mage-stuff");J.onchange=o=>{switch(+o.target.value){case 0:L=0;break;case 1:L=0;break;case 2:L=2;break;case 3:L=4;break;case 4:L=6;break;case 5:L=8;break;default:L=8;break}const p=document.querySelectorAll(".moon-dc-label");for(const C of p){const f=+C.getAttribute("data-dc");C.textContent=`Spell DC: ${(f+L).toString()}`}};ne?.appendChild(J);const ae=document.getElementById("profLevelContainer"),z=document.createElement("div");z.textContent="Proficiency: ";z.classList.add("moon-phase-label");z.style.marginTop="4px";ae?.appendChild(z);const K=document.createElement("input");K.id="profInput";K.type="number";K.classList.add("moon-mage-stuff");ae?.appendChild(K);const ye=document.getElementById("moonContainer"),m=document.getElementById("currentDay"),y=document.getElementById("currentMonth");h.onReady(async()=>{const o=await h.theme.getTheme();se(o,document),h.theme.onChange(t=>{se(t,document)});const s=await h.player.getRole(),d=await h.player.getId(),p=await h.room.getMetadata();if(V=p[`${$.EXTENSIONID}/bdOff${d}`],P=p[`${$.EXTENSIONID}/saveData`],_(),M(),u(),P&&await U(P),s==="GM"&&(document.getElementById("calendar").style.height="94%"),s==="PLAYER"){document.getElementById("floating-header").style.display="none",document.getElementById("calendar").style.marginTop="0",document.getElementById("titleLine").style.marginTop="2px",h.room.onMetadataChange(async t=>{const a=t[`${$.EXTENSIONID}/saveData`],n=he(a,P);a&&!n&&await U(a),P=t[`${$.EXTENSIONID}/saveData`]});return}h.room.onMetadataChange(async t=>{const a=t[`${$.OUTSIDEID}/data`];a&&(De(a.Timestamp,"Outside","CALENDAR")||(m.value=(+m.value+ +a.Increment).toString(),await A()))});const C=document.querySelectorAll("#floating-header button"),f=document.querySelectorAll(".content");C.forEach(t=>{t.addEventListener("click",function(){let a=t.textContent?.toLowerCase();a==="generate"&&(a="calendar"),a&&(f.forEach(n=>{n.style.display=n.id===a?"block":"none"}),C.forEach(n=>{n.classList.remove("button-selected")}),t===Me?ue.classList.add("button-selected"):t.classList.add("button-selected"))})}),y.onchange=async()=>await A(),m.onchange=async()=>await A(),Ne.onclick=async()=>await oe(),we.onclick=async()=>await U(),x.onchange=()=>u(),H.onchange=()=>_(),S.onchange=()=>M();function M(){re.innerHTML="";for(let t=1;t<=+S.value;t++){const a=document.createElement("div");a.innerHTML=`
            <label for="month${t}Name">Name ${t}:</label>
            <input type="text" id="month${t}Name" name="month${t}Name" value="Month${t}">
    
            <label for="month${t}Days">Days:</label>
            <input type="number" class="input-mini" id="month${t}Days" name="month${t}Days" min="1" value="30">
          `,re.appendChild(a)}}function u(){ce.innerHTML="";for(let t=1;t<=+x.value;t++){const a=document.createElement("div");a.innerHTML=`
            <label for="day${t}Name">Day ${t} Name:</label>
            <input type="text" id="day${t}Name" name="day${t}Name" value="Day${t}">
          `,ce.appendChild(a)}}function _(){ie.innerHTML="";for(let t=1;t<=+H.value;t++){const a=document.createElement("div");a.innerHTML=`
            <label for="moon${t}Name">Name ${t}:</label>
            <input type="text" class="moon-input" id="moon${t}Name" name="moon${t}Name" value="Moon${t}">
    
            <label for="moon${t}Cycle">Cycle ${t} (days):</label>
            <input type="number" class="input-mini" id="moon${t}Cycle" name="moon${t}Cycle" min="1" value="30">
    
            <label for="moon${t}Shift">Shift ${t}:</label>
            <input type="number" class="input-mini" id="moon${t}Shift" name="moon${t}Shift" min="0" value="0">
          `,ie.appendChild(a)}}function g(t,a,n){return document.getElementById(`${t}${a}${n}`).value}async function oe(){const t=[],a=[];for(let c=1;c<=+S.value;c++){const i=g("month",c,"Name"),N=g("month",c,"Days");t.push(i),a.push(N)}const n=[];for(let c=1;c<=+x.value;c++){const i=g("day",c,"Name");n.push(i)}const l=document.createElement("div");l.classList.add("calendar-system-container");const e=document.createElement("button");e.title="Select Previous Day",e.classList.add("day-back-button"),e.classList.add("clickable"),e.style.background="url(./back-day.svg) no-repeat center center",e.style.backgroundSize="contain",e.onclick=async()=>{m.value=(+m.value-1).toString(),await A()};const r=document.createElement("button");r.title="Select Next Day",r.classList.add("day-forward-button"),r.classList.add("clickable"),r.style.background="url(./forward-day.svg) no-repeat center center",r.style.backgroundSize="contain",r.onclick=async()=>{m.value=(+m.value+1).toString(),await A()};const b=document.createElement("button");b.classList.add("title-line"),b.title="Click to toggle on/off the Day Tag on the Action button.",b.value=V?"OFF":"ON",b.textContent=ee.value,b.onclick=async c=>{c.preventDefault(),b.value==="ON"?(await h.action.setBadgeText(void 0),await h.room.setMetadata({[`${$.EXTENSIONID}/bdOff${d}`]:!0}),b.value="OFF"):(await h.action.setBadgeText(X),await h.room.setMetadata({[`${$.EXTENSIONID}/bdOff${d}`]:!1}),b.value="ON")},G.innerHTML="",s==="GM"&&G.appendChild(e),G.appendChild(b),s==="GM"&&G.appendChild(r);const v=parseInt(te.value),E=parseInt(x.value);let k=v>E?v%E:v,I=!0;for(let c=0;c<+S.value;c++){const i=document.createElement("button");i.title="View previous Month",i.classList.add("mon-back-button"),i.classList.add("clickable"),i.style.background="url(./back-month.svg) no-repeat center center",i.style.backgroundSize="contain",i.onclick=()=>{let w=O-1;w<1&&(w=+S.value),O=w,Q()};const N=document.createElement("button");N.title="View next Month",N.classList.add("mon-forward-button"),N.classList.add("clickable"),N.style.background="url(./forward-month.svg) no-repeat center center",N.style.backgroundSize="contain",N.onclick=async()=>{let w=O+1;w>+S.value&&(w=1),O=w,Q()};const D=document.createElement("table");D.classList.add("calendar-system"),D.id=`monthTable${c}`;const W=t[c]?t[c]:`Month ${(c+1).toString()}`,R=D.insertRow();R.classList.add("month-row");const T=R.insertCell();T.classList.add("month-header-cell"),T.appendChild(i),T.appendChild(document.createTextNode(W)),T.appendChild(N),T.colSpan=+x.value;const Y=D.insertRow();for(const w of n){const F=Y.insertCell();F.textContent=w,F.classList.add("day-header")}let B=k;for(let w=1;w<=+a[c];w++){if(I){D.insertRow();const be=D.rows[D.rows.length-1];for(let le=1;le<B;le++)be.insertCell();I=!1}else B===1&&D.insertRow();const q=D.rows[D.rows.length-1].insertCell();q.textContent=`${w}`,q.setAttribute("data-month",(c+1).toString()),q.setAttribute("data-day",w.toString()),q.classList.add("day-cell"),B++,B>+x.value&&(B=1)}k=B,I=!0,l.appendChild(D)}de.innerHTML="",de.appendChild(l),O=+y.value,await A()}function pe(){const t=[];for(let e=1;e<=+x.value;e++){const r=g("day",e,"Name");t.push(r)}const a=[];for(let e=1;e<=+S.value;e++){const r=g("month",e,"Name"),b=g("month",e,"Days");a.push({Name:r,Days:b})}const n=[];for(let e=1;e<=+H.value;e++){const r=g("moon",e,"Name"),b=g("moon",e,"Cycle"),v=g("moon",e,"Shift");n.push({Name:r,Cycle:b,Shift:v})}return{NameYear:ee.value,CurrentDay:m.value,StartDayYear:(parseInt(te.value)-1).toString(),CurrentMonth:y.value,NumberMonth:S.value,DaysPerWeek:x.value,NumberMoons:H.value,MoonSet:n,MonthSet:a,DaySet:t}}function Q(t=!1){const a=document.querySelectorAll(".calendar-system");let n=O!==+y.value?O:+y.value;t&&(n=+y.value);let l=me<n;for(const e of a)e.id===`monthTable${n-1}`?setTimeout(()=>{me=n,e.style.display="table",e.style.transform=l?"translateX(100%)":"translateX(-100%)",e.offsetHeight,e.style.transform="translateX(0%)",e.style.transition="transform 0.2s ease-in-out"},200):(e.style.transform=l?"translateX(-100%)":"translateX(100%)",e.style.transition="transform 0.2s ease-in-out",setTimeout(()=>{e.style.display="none"},200))}async function A(){const t=g("month",+y.value,"Days");if(+m.value>+t){let e=+y.value+1;e>+S.value?(m.value="1",y.value="1"):(y.value=e.toString(),m.value="1")}else if(+m.value<1){let e=+y.value-1;if(e<1){const r=g("month",+S.value-1,"Days");m.value=r,y.value=S.value}else{const r=g("month",e,"Days");y.value=(+y.value-1).toString(),m.value=r}}document.querySelectorAll(".calendar-system td").forEach(e=>e.classList.remove("current-date"));const n=document.querySelector(`.calendar-system td[data-month="${y.value}"][data-day="${m.value}"]`);n&&n.classList.add("current-date"),Q(!0);const l=[];for(let e=1;e<=+H.value;e++){const r=g("moon",e,"Name"),b=g("moon",e,"Cycle"),v=g("moon",e,"Shift");l.push({name:r,cycle:b,shift:v})}ye.innerHTML="";for(const e of l){const r=fe(+m.value,+e.cycle,+e.shift,e.name);ye.appendChild(r)}if(s==="GM"){const e=pe();await h.room.setMetadata({[`${$.EXTENSIONID}/saveData`]:e}),X=`${e?.MonthSet[+e.CurrentMonth-1]?.Name??e?.CurrentMonth}:${e?.CurrentDay}`,V||await h.action.setBadgeText(X)}}function fe(t,a,n,l){console.log("hit");let e=t;const r=parseInt(y.value);for(let Y=1;Y<r;Y++){const B=g("month",Y,"Days");e+=parseInt(B)}const v=(e+n-1)%a/a;let E,k,I;v<.0625||v>=.9375?(E="/new_moon.png",k="New Moon",I="20"):v<.1875?(E="/waxing_crescent.png",k="Waxing Crescent",I="15"):v<.3125?(E="/first_quarter.png",k="First Quarter",I="10"):v<.4375?(E="/waxing_gibbous.png",k="Waxing Gibbous",I="8"):v<.5625?(E="/full_moon.png",k="Full Moon",I="5"):v<.6875?(E="/waning_gibbous.png",k="Waning Gibbous",I="8"):v<.8125?(E="/third_quarter.png",k="Third Quarter",I="10"):(E="/waning_crescent.png",k="Waning Crescent",I="15");let c=Ce(l);switch(l){case"Katamba":c="#000000";break;case"Yavash":c="#FF0000";break;case"Xibar":c="#739BD0";break}const i=document.createElement("div"),N=document.createElement("section");N.classList.add("moon-icon"),N.style.setProperty("--moon-color",c);const D=document.createElement("label");D.textContent=l,D.classList.add("moon-name-label");const W=document.createElement("label");W.textContent=`Spell DC: ${+I+L}`,W.setAttribute("data-dc",I),W.classList.add("moon-dc-label");const R=document.createElement("label");R.textContent=k,R.classList.add("moon-phase-label");const T=document.createElement("img");return T.src=E,T.classList.add("moon-image"),T.title=l,N.appendChild(T),i.appendChild(R),i.appendChild(N),i.appendChild(D),(l==="Xibar"||l==="Katamba"||l==="Yavash")&&(i.appendChild(document.createElement("br")),i.appendChild(W),ne.style.display="block",ae.style.display="block"),i}async function U(t){const a=document.getElementById("donjonJson").value;let n;try{t?(n=ge(t),y.value=t.CurrentMonth,m.value=t.CurrentDay):n=JSON.parse(a),ee.value=n.year?n.year:"Default Calendar Name",S.value=n.n_months?n.n_months:"12",M();for(let e=1;e<=n.n_months;e++)document.getElementById(`month${e}Name`).value=n.months[e-1]?n.months[e-1]:`DefaultMonth#${e}`,document.getElementById(`month${e}Days`).value=n.month_len[n.months[e-1]]?n.month_len[n.months[e-1]]:"28";document.getElementById("daysPerWeek").value=n.weekdays.length>0?n.weekdays.length:"7",u();for(let e=1;e<=n.weekdays.length;e++)document.getElementById(`day${e}Name`).value=n.weekdays[e-1]?n.weekdays[e-1]:`DefaultDay#${e}`;document.getElementById("numMoons").value=n.n_moons?n.n_moons:"2",_();for(let e=1;e<=n.n_moons;e++)document.getElementById(`moon${e}Name`).value=n.moons[e-1]?n.moons[e-1]:`DefaultMoon#${e}`,document.getElementById(`moon${e}Cycle`).value=n.lunar_cyc[n.moons[e-1]]?n.lunar_cyc[n.moons[e-1]]:"28",document.getElementById(`moon${e}Shift`).value=n.lunar_shf[n.moons[e-1]]?n.lunar_shf[n.moons[e-1]]:"0";document.getElementById("totalDaysInYear").value=n.year_len?n.year_len:"336",te.value=n.first_day?(parseInt(n.first_day)+1).toString():"1",await oe(),X=`${t?.MonthSet[+t.CurrentMonth-1]?.Name??t?.CurrentMonth}:${t?.CurrentDay}`,V||await h.action.setBadgeText(X),t||(ue.click(),await h.notification.show("Calendar Imported Successfully!","SUCCESS"))}catch(l){alert("Invalid Calendar Format."),console.error(l)}}function ge(t){const a={};return a.year=t.NameYear||"Default Calendar Name",a.n_months=t.NumberMonth||"12",a.months=[],a.month_len={},t.MonthSet.forEach((n,l)=>{a.months[l]=n.Name||`DefaultMonth#${l+1}`,a.month_len[a.months[l]]=n.Days||"28"}),a.weekdays=t.DaySet||["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],a.weekdays.forEach((n,l)=>{a.weekdays[l]=n||`DefaultDay#${l+1}`}),a.n_moons=t.NumberMoons||"2",a.moons=[],a.lunar_cyc={},a.lunar_shf={},t.MoonSet.forEach((n,l)=>{a.moons[l]=n.Name||`DefaultMoon#${l+1}`,a.lunar_cyc[a.moons[l]]=n.Cycle||"28",a.lunar_shf[a.moons[l]]=n.Shift||"0"}),a.year_len=t.DaysPerWeek||"336",a.first_day=t.StartDayYear||"0",a}});
