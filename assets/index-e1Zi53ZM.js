var Ft=Object.defineProperty;var Kt=(n,e,t)=>e in n?Ft(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ut=(n,e,t)=>(Kt(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var D=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class zt{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return D(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,t){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:t})})}deselect(e){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return D(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return D(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return D(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return D(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return D(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return D(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return D(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return D(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:o}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return o.indexOf(e)>-1})}getConnectionId(){return D(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const t=o=>{e(o.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",t)}}}var H=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class Xt{constructor(e){this.messageBus=e}reset(){return H(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return H(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return H(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return H(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return H(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return H(this,void 0,void 0,function*(){const{point:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return t})}inverseTransformPoint(e){return H(this,void 0,void 0,function*(){const{point:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return t})}}function qt(n){return typeof n.id=="string"}var qe={exports:{}},ce=typeof Reflect=="object"?Reflect:null,ct=ce&&typeof ce.apply=="function"?ce.apply:function(e,t,o){return Function.prototype.apply.call(e,t,o)},Ae;ce&&typeof ce.ownKeys=="function"?Ae=ce.ownKeys:Object.getOwnPropertySymbols?Ae=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Ae=function(e){return Object.getOwnPropertyNames(e)};function Jt(n){console&&console.warn&&console.warn(n)}var Lt=Number.isNaN||function(e){return e!==e};function g(){g.init.call(this)}qe.exports=g;qe.exports.once=tn;g.EventEmitter=g;g.prototype._events=void 0;g.prototype._eventsCount=0;g.prototype._maxListeners=void 0;var dt=10;function Me(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return dt},set:function(n){if(typeof n!="number"||n<0||Lt(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");dt=n}});g.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};g.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Lt(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Dt(n){return n._maxListeners===void 0?g.defaultMaxListeners:n._maxListeners}g.prototype.getMaxListeners=function(){return Dt(this)};g.prototype.emit=function(e){for(var t=[],o=1;o<arguments.length;o++)t.push(arguments[o]);var s=e==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var d=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw d.context=r,d}var l=i[e];if(l===void 0)return!1;if(typeof l=="function")ct(l,this,t);else for(var u=l.length,a=Ut(l,u),o=0;o<u;++o)ct(a[o],this,t);return!0};function xt(n,e,t,o){var s,i,r;if(Me(t),i=n._events,i===void 0?(i=n._events=Object.create(null),n._eventsCount=0):(i.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),i=n._events),r=i[e]),r===void 0)r=i[e]=t,++n._eventsCount;else if(typeof r=="function"?r=i[e]=o?[t,r]:[r,t]:o?r.unshift(t):r.push(t),s=Dt(n),s>0&&r.length>s&&!r.warned){r.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=n,d.type=e,d.count=r.length,Jt(d)}return n}g.prototype.addListener=function(e,t){return xt(this,e,t,!1)};g.prototype.on=g.prototype.addListener;g.prototype.prependListener=function(e,t){return xt(this,e,t,!0)};function Qt(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Pt(n,e,t){var o={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},s=Qt.bind(o);return s.listener=t,o.wrapFn=s,s}g.prototype.once=function(e,t){return Me(t),this.on(e,Pt(this,e,t)),this};g.prototype.prependOnceListener=function(e,t){return Me(t),this.prependListener(e,Pt(this,e,t)),this};g.prototype.removeListener=function(e,t){var o,s,i,r,d;if(Me(t),s=this._events,s===void 0)return this;if(o=s[e],o===void 0)return this;if(o===t||o.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,o.listener||t));else if(typeof o!="function"){for(i=-1,r=o.length-1;r>=0;r--)if(o[r]===t||o[r].listener===t){d=o[r].listener,i=r;break}if(i<0)return this;i===0?o.shift():Zt(o,i),o.length===1&&(s[e]=o[0]),s.removeListener!==void 0&&this.emit("removeListener",e,d||t)}return this};g.prototype.off=g.prototype.removeListener;g.prototype.removeAllListeners=function(e){var t,o,s;if(o=this._events,o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete o[e]),this;if(arguments.length===0){var i=Object.keys(o),r;for(s=0;s<i.length;++s)r=i[s],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=o[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this};function Gt(n,e,t){var o=n._events;if(o===void 0)return[];var s=o[e];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?en(s):Ut(s,s.length)}g.prototype.listeners=function(e){return Gt(this,e,!0)};g.prototype.rawListeners=function(e){return Gt(this,e,!1)};g.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):kt.call(n,e)};g.prototype.listenerCount=kt;function kt(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}g.prototype.eventNames=function(){return this._eventsCount>0?Ae(this._events):[]};function Ut(n,e){for(var t=new Array(e),o=0;o<e;++o)t[o]=n[o];return t}function Zt(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function en(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function tn(n,e){return new Promise(function(t,o){function s(r){n.removeListener(e,i),o(r)}function i(){typeof n.removeListener=="function"&&n.removeListener("error",s),t([].slice.call(arguments))}$t(n,e,i,{once:!0}),e!=="error"&&nn(n,s,{once:!0})})}function nn(n,e,t){typeof n.on=="function"&&$t(n,"error",e,t)}function $t(n,e,t,o){if(typeof n.on=="function")o.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function s(i){o.once&&n.removeEventListener(e,s),t(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var on=qe.exports;let Oe;const sn=new Uint8Array(16);function rn(){if(!Oe&&(Oe=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Oe))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Oe(sn)}const S=[];for(let n=0;n<256;++n)S.push((n+256).toString(16).slice(1));function an(n,e=0){return S[n[e+0]]+S[n[e+1]]+S[n[e+2]]+S[n[e+3]]+"-"+S[n[e+4]]+S[n[e+5]]+"-"+S[n[e+6]]+S[n[e+7]]+"-"+S[n[e+8]]+S[n[e+9]]+"-"+S[n[e+10]]+S[n[e+11]]+S[n[e+12]]+S[n[e+13]]+S[n[e+14]]+S[n[e+15]]}const un=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),lt={randomUUID:un};function cn(n,e,t){if(lt.randomUUID&&!e&&!n)return lt.randomUUID();n=n||{};const o=n.random||(n.rng||rn)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=o[s];return e}return an(o)}class dn extends on.EventEmitter{constructor(e,t){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=o=>{const s=o.data;if(o.origin===this.targetOrigin&&qt(s)){if(s.id==="OBR_READY"){this.ready=!0;const i=s.data;this.ref=i.ref,this.userId=i.userId}this.emit(s.id,s.data)}},this.send=(o,s,i)=>{var r;if(!this.ref)throw Error("Unable to send message: not ready");(r=window.parent)===null||r===void 0||r.postMessage({id:o,data:s,ref:this.ref,nonce:i},this.targetOrigin)},this.sendAsync=(o,s,i=5e3)=>{const r=`_${cn()}`;return this.send(o,s,r),Promise.race([new Promise((d,l)=>{const u=this;function a(p){u.off(`${o}_RESPONSE${r}`,a),u.off(`${o}_ERROR${r}`,c),d(p)}function c(p){u.off(`${o}_RESPONSE${r}`,a),u.off(`${o}_ERROR${r}`,c),l(p)}this.on(`${o}_RESPONSE${r}`,a),this.on(`${o}_ERROR${r}`,c)}),new Promise((d,l)=>window.setTimeout(()=>l(new Error(`Message ${o} took longer than ${i}ms to get a result`)),i))])},this.roomId=t,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var ht=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class ln{constructor(e){this.messageBus=e}show(e,t){return ht(this,void 0,void 0,function*(){const{id:o}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:t});return o})}close(e){return ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var ie=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class hn{constructor(e){this.messageBus=e}getColor(){return ie(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return ie(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return ie(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return ie(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return ie(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return ie(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const t=o=>{e(o.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",t)}}}var x=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class fn{constructor(e){this.messageBus=e}getDpi(){return x(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return x(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return x(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return x(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return x(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return x(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return x(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,t,o,s){return x(this,void 0,void 0,function*(){const{position:i}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:t,useCorners:o,useCenter:s});return i})}getDistance(e,t){return x(this,void 0,void 0,function*(){const{distance:o}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:t});return o})}onChange(e){const t=o=>{e(o.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",t)}}}var ge=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class mn{constructor(e){this.messageBus=e}undo(){return ge(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return ge(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return ge(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return ge(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function M(n){for(var e=arguments.length,t=Array(e>1?e-1:0),o=1;o<e;o++)t[o-1]=arguments[o];throw Error("[Immer] minified error nr: "+n+(t.length?" "+t.map(function(s){return"'"+s+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function ne(n){return!!n&&!!n[U]}function z(n){var e;return!!n&&(function(t){if(!t||typeof t!="object")return!1;var o=Object.getPrototypeOf(t);if(o===null)return!0;var s=Object.hasOwnProperty.call(o,"constructor")&&o.constructor;return s===Object||typeof s=="function"&&Function.toString.call(s)===Tn}(n)||Array.isArray(n)||!!n[me]||!!(!((e=n.constructor)===null||e===void 0)&&e[me])||we(n)||be(n))}function de(n,e,t){t===void 0&&(t=!1),X(n)===0?(t?Object.keys:ot)(n).forEach(function(o){t&&typeof o=="symbol"||e(o,n[o],n)}):n.forEach(function(o,s){return e(s,o,n)})}function X(n){var e=n[U];return e?e.i>3?e.i-4:e.i:Array.isArray(n)?1:we(n)?2:be(n)?3:0}function ye(n,e){return X(n)===2?n.has(e):Object.prototype.hasOwnProperty.call(n,e)}function Ce(n,e){return X(n)===2?n.get(e):n[e]}function Vt(n,e,t){var o=X(n);o===2?n.set(e,t):o===3?n.add(t):n[e]=t}function _n(n,e){return n===e?n!==0||1/n==1/e:n!=n&&e!=e}function we(n){return On&&n instanceof Map}function be(n){return gn&&n instanceof Set}function Q(n){return n.o||n.t}function Je(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var e=Bn(n);delete e[U];for(var t=ot(e),o=0;o<t.length;o++){var s=t[o],i=e[s];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(e[s]={configurable:!0,writable:!0,enumerable:i.enumerable,value:n[s]})}return Object.create(Object.getPrototypeOf(n),e)}function Qe(n,e){return e===void 0&&(e=!1),Ze(n)||ne(n)||!z(n)||(X(n)>1&&(n.set=n.add=n.clear=n.delete=yn),Object.freeze(n),e&&de(n,function(t,o){return Qe(o,!0)},!0)),n}function yn(){M(2)}function Ze(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function Y(n){var e=Ke[n];return e||M(18,n),e}function En(n,e){Ke[n]||(Ke[n]=e)}function ft(){return Ee}function Ge(n,e){e&&(Y("Patches"),n.u=[],n.s=[],n.v=e)}function Se(n){Ye(n),n.p.forEach(pn),n.p=null}function Ye(n){n===Ee&&(Ee=n.l)}function mt(n){return Ee={p:[],l:Ee,h:n,m:!0,_:0}}function pn(n){var e=n[U];e.i===0||e.i===1?e.j():e.g=!0}function ke(n,e){e._=e.p.length;var t=e.p[0],o=n!==void 0&&n!==t;return e.h.O||Y("ES5").S(e,n,o),o?(t[U].P&&(Se(e),M(4)),z(n)&&(n=Ne(e,n),e.l||Ie(e,n)),e.u&&Y("Patches").M(t[U].t,n,e.u,e.s)):n=Ne(e,t,[]),Se(e),e.u&&e.v(e.u,e.s),n!==nt?n:void 0}function Ne(n,e,t){if(Ze(e))return e;var o=e[U];if(!o)return de(e,function(d,l){return _t(n,o,e,d,l,t)},!0),e;if(o.A!==n)return e;if(!o.P)return Ie(n,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var s=o.i===4||o.i===5?o.o=Je(o.k):o.o,i=s,r=!1;o.i===3&&(i=new Set(s),s.clear(),r=!0),de(i,function(d,l){return _t(n,o,s,d,l,t,r)}),Ie(n,s,!1),t&&n.u&&Y("Patches").N(o,t,n.u,n.s)}return o.o}function _t(n,e,t,o,s,i,r){if(ne(s)){var d=Ne(n,s,i&&e&&e.i!==3&&!ye(e.R,o)?i.concat(o):void 0);if(Vt(t,o,d),!ne(d))return;n.m=!1}else r&&t.add(s);if(z(s)&&!Ze(s)){if(!n.h.D&&n._<1)return;Ne(n,s),e&&e.A.l||Ie(n,s)}}function Ie(n,e,t){t===void 0&&(t=!1),!n.l&&n.h.D&&n.m&&Qe(e,t)}function Ue(n,e){var t=n[U];return(t?Q(t):n)[e]}function yt(n,e){if(e in n)for(var t=Object.getPrototypeOf(n);t;){var o=Object.getOwnPropertyDescriptor(t,e);if(o)return o;t=Object.getPrototypeOf(t)}}function We(n){n.P||(n.P=!0,n.l&&We(n.l))}function $e(n){n.o||(n.o=Je(n.t))}function Fe(n,e,t){var o=we(e)?Y("MapSet").F(e,t):be(e)?Y("MapSet").T(e,t):n.O?function(s,i){var r=Array.isArray(s),d={i:r?1:0,A:i?i.A:ft(),P:!1,I:!1,R:{},l:i,t:s,k:null,o:null,j:null,C:!1},l=d,u=ze;r&&(l=[d],u=fe);var a=Proxy.revocable(l,u),c=a.revoke,p=a.proxy;return d.k=p,d.j=c,p}(e,t):Y("ES5").J(e,t);return(t?t.A:ft()).p.push(o),o}function vn(n){return ne(n)||M(22,n),function e(t){if(!z(t))return t;var o,s=t[U],i=X(t);if(s){if(!s.P&&(s.i<4||!Y("ES5").K(s)))return s.t;s.I=!0,o=Et(t,i),s.I=!1}else o=Et(t,i);return de(o,function(r,d){s&&Ce(s.t,r)===d||Vt(o,r,e(d))}),i===3?new Set(o):o}(n)}function Et(n,e){switch(e){case 2:return new Map(n);case 3:return Array.from(n)}return Je(n)}function et(){function n(o){if(!z(o))return o;if(Array.isArray(o))return o.map(n);if(we(o))return new Map(Array.from(o.entries()).map(function(r){return[r[0],n(r[1])]}));if(be(o))return new Set(Array.from(o).map(n));var s=Object.create(Object.getPrototypeOf(o));for(var i in o)s[i]=n(o[i]);return ye(o,me)&&(s[me]=o[me]),s}function e(o){return ne(o)?n(o):o}var t="add";En("Patches",{$:function(o,s){return s.forEach(function(i){for(var r=i.path,d=i.op,l=o,u=0;u<r.length-1;u++){var a=X(l),c=r[u];typeof c!="string"&&typeof c!="number"&&(c=""+c),a!==0&&a!==1||c!=="__proto__"&&c!=="constructor"||M(24),typeof l=="function"&&c==="prototype"&&M(24),typeof(l=Ce(l,c))!="object"&&M(15,r.join("/"))}var p=X(l),E=n(i.value),T=r[r.length-1];switch(d){case"replace":switch(p){case 2:return l.set(T,E);case 3:M(16);default:return l[T]=E}case t:switch(p){case 1:return T==="-"?l.push(E):l.splice(T,0,E);case 2:return l.set(T,E);case 3:return l.add(E);default:return l[T]=E}case"remove":switch(p){case 1:return l.splice(T,1);case 2:return l.delete(T);case 3:return l.delete(i.value);default:return delete l[T]}default:M(17,d)}}),o},N:function(o,s,i,r){switch(o.i){case 0:case 4:case 2:return function(d,l,u,a){var c=d.t,p=d.o;de(d.R,function(E,T){var B=Ce(c,E),w=Ce(p,E),h=T?ye(c,E)?"replace":t:"remove";if(B!==w||h!=="replace"){var f=l.concat(E);u.push(h==="remove"?{op:h,path:f}:{op:h,path:f,value:w}),a.push(h===t?{op:"remove",path:f}:h==="remove"?{op:t,path:f,value:e(B)}:{op:"replace",path:f,value:e(B)})}})}(o,s,i,r);case 5:case 1:return function(d,l,u,a){var c=d.t,p=d.R,E=d.o;if(E.length<c.length){var T=[E,c];c=T[0],E=T[1];var B=[a,u];u=B[0],a=B[1]}for(var w=0;w<c.length;w++)if(p[w]&&E[w]!==c[w]){var h=l.concat([w]);u.push({op:"replace",path:h,value:e(E[w])}),a.push({op:"replace",path:h,value:e(c[w])})}for(var f=c.length;f<E.length;f++){var m=l.concat([f]);u.push({op:t,path:m,value:e(E[f])})}c.length<E.length&&a.push({op:"replace",path:l.concat(["length"]),value:c.length})}(o,s,i,r);case 3:return function(d,l,u,a){var c=d.t,p=d.o,E=0;c.forEach(function(T){if(!p.has(T)){var B=l.concat([E]);u.push({op:"remove",path:B,value:T}),a.unshift({op:t,path:B,value:T})}E++}),E=0,p.forEach(function(T){if(!c.has(T)){var B=l.concat([E]);u.push({op:t,path:B,value:T}),a.unshift({op:"remove",path:B,value:T})}E++})}(o,s,i,r)}},M:function(o,s,i,r){i.push({op:"replace",path:[],value:s===nt?void 0:s}),r.push({op:"replace",path:[],value:o})}})}var pt,Ee,tt=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",On=typeof Map<"u",gn=typeof Set<"u",vt=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",nt=tt?Symbol.for("immer-nothing"):((pt={})["immer-nothing"]=!0,pt),me=tt?Symbol.for("immer-draftable"):"__$immer_draftable",U=tt?Symbol.for("immer-state"):"__$immer_state",Tn=""+Object.prototype.constructor,ot=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,Bn=Object.getOwnPropertyDescriptors||function(n){var e={};return ot(n).forEach(function(t){e[t]=Object.getOwnPropertyDescriptor(n,t)}),e},Ke={},ze={get:function(n,e){if(e===U)return n;var t=Q(n);if(!ye(t,e))return function(s,i,r){var d,l=yt(i,r);return l?"value"in l?l.value:(d=l.get)===null||d===void 0?void 0:d.call(s.k):void 0}(n,t,e);var o=t[e];return n.I||!z(o)?o:o===Ue(n.t,e)?($e(n),n.o[e]=Fe(n.A.h,o,n)):o},has:function(n,e){return e in Q(n)},ownKeys:function(n){return Reflect.ownKeys(Q(n))},set:function(n,e,t){var o=yt(Q(n),e);if(o!=null&&o.set)return o.set.call(n.k,t),!0;if(!n.P){var s=Ue(Q(n),e),i=s==null?void 0:s[U];if(i&&i.t===t)return n.o[e]=t,n.R[e]=!1,!0;if(_n(t,s)&&(t!==void 0||ye(n.t,e)))return!0;$e(n),We(n)}return n.o[e]===t&&(t!==void 0||e in n.o)||Number.isNaN(t)&&Number.isNaN(n.o[e])||(n.o[e]=t,n.R[e]=!0),!0},deleteProperty:function(n,e){return Ue(n.t,e)!==void 0||e in n.t?(n.R[e]=!1,$e(n),We(n)):delete n.R[e],n.o&&delete n.o[e],!0},getOwnPropertyDescriptor:function(n,e){var t=Q(n),o=Reflect.getOwnPropertyDescriptor(t,e);return o&&{writable:!0,configurable:n.i!==1||e!=="length",enumerable:o.enumerable,value:t[e]}},defineProperty:function(){M(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){M(12)}},fe={};de(ze,function(n,e){fe[n]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),fe.deleteProperty=function(n,e){return fe.set.call(this,n,e,void 0)},fe.set=function(n,e,t){return ze.set.call(this,n[0],e,t,n[0])};var An=function(){function n(t){var o=this;this.O=vt,this.D=!0,this.produce=function(s,i,r){if(typeof s=="function"&&typeof i!="function"){var d=i;i=s;var l=o;return function(B){var w=this;B===void 0&&(B=d);for(var h=arguments.length,f=Array(h>1?h-1:0),m=1;m<h;m++)f[m-1]=arguments[m];return l.produce(B,function(_){var y;return(y=i).call.apply(y,[w,_].concat(f))})}}var u;if(typeof i!="function"&&M(6),r!==void 0&&typeof r!="function"&&M(7),z(s)){var a=mt(o),c=Fe(o,s,void 0),p=!0;try{u=i(c),p=!1}finally{p?Se(a):Ye(a)}return typeof Promise<"u"&&u instanceof Promise?u.then(function(B){return Ge(a,r),ke(B,a)},function(B){throw Se(a),B}):(Ge(a,r),ke(u,a))}if(!s||typeof s!="object"){if((u=i(s))===void 0&&(u=s),u===nt&&(u=void 0),o.D&&Qe(u,!0),r){var E=[],T=[];Y("Patches").M(s,u,E,T),r(E,T)}return u}M(21,s)},this.produceWithPatches=function(s,i){if(typeof s=="function")return function(u){for(var a=arguments.length,c=Array(a>1?a-1:0),p=1;p<a;p++)c[p-1]=arguments[p];return o.produceWithPatches(u,function(E){return s.apply(void 0,[E].concat(c))})};var r,d,l=o.produce(s,i,function(u,a){r=u,d=a});return typeof Promise<"u"&&l instanceof Promise?l.then(function(u){return[u,r,d]}):[l,r,d]},typeof(t==null?void 0:t.useProxies)=="boolean"&&this.setUseProxies(t.useProxies),typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze)}var e=n.prototype;return e.createDraft=function(t){z(t)||M(8),ne(t)&&(t=vn(t));var o=mt(this),s=Fe(this,t,void 0);return s[U].C=!0,Ye(o),s},e.finishDraft=function(t,o){var s=t&&t[U],i=s.A;return Ge(i,o),ke(void 0,i)},e.setAutoFreeze=function(t){this.D=t},e.setUseProxies=function(t){t&&!vt&&M(20),this.O=t},e.applyPatches=function(t,o){var s;for(s=o.length-1;s>=0;s--){var i=o[s];if(i.path.length===0&&i.op==="replace"){t=i.value;break}}s>-1&&(o=o.slice(s+1));var r=Y("Patches").$;return ne(t)?r(t,o):this.produce(t,function(d){return r(d,o)})},n}(),$=new An;$.produce;var st=$.produceWithPatches.bind($);$.setAutoFreeze.bind($);$.setUseProxies.bind($);$.applyPatches.bind($);$.createDraft.bind($);$.finishDraft.bind($);var re=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};et();class Cn{constructor(e){this.messageBus=e}getItems(e){return re(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return t}else if(e){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return t.filter(e)}else{const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return t}})}isItemArray(e){return Array.isArray(e)&&e.every(t=>typeof t!="string")}updateItems(e,t,o=!0){return re(this,void 0,void 0,function*(){let s;this.isItemArray(e)?s=e:s=yield this.getItems(e);const[i,r]=st(s,t),d=i.map(l=>({id:l.id,type:l.type}));for(const l of r){const[u,a]=l.path;typeof u=="number"&&typeof a=="string"&&(d[u][a]=i[u][a])}yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:d,updateAttachments:o})})}addItems(e){return re(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return re(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return re(this,void 0,void 0,function*(){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return t})}getItemBounds(e){return re(this,void 0,void 0,function*(){const{bounds:t}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return t})}onChange(e){const t=o=>{e(o.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",t)}}}var ae=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};et();class Rn{constructor(e){this.messageBus=e}getItems(e){return ae(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return t}else if(e){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return t.filter(e)}else{const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return t}})}updateItems(e,t,o,s=!0){return ae(this,void 0,void 0,function*(){const i=yield this.getItems(e),[r,d]=st(i,t),l=r.map(u=>({id:u.id,type:u.type}));for(const u of d){const[a,c]=u.path;typeof a=="number"&&typeof c=="string"&&(l[a][c]=r[a][c])}yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:l,fastUpdate:o,updateAttachments:s})})}addItems(e){return ae(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return ae(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return ae(this,void 0,void 0,function*(){const{items:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return t})}getItemBounds(e){return ae(this,void 0,void 0,function*(){const{bounds:t}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return t})}onChange(e){const t=o=>{e(o.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",t)}}}var Ve=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class Sn{constructor(e){this.messageBus=e,this.grid=new fn(e),this.fog=new hn(e),this.history=new mn(e),this.items=new Cn(e),this.local=new Rn(e)}isReady(){return Ve(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const t=o=>{e(o.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",t)}}getMetadata(){return Ve(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return Ve(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const t=o=>{e(o.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",t)}}}function Ht(n){return n.startsWith("http")?n:`${window.location.origin}${n}`}function _e(n){return n.map(e=>Object.assign(Object.assign({},e),{icon:Ht(e.icon)}))}function it(n){return Object.assign(Object.assign({},n),{url:Ht(n.url)})}var Ot=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class Nn{constructor(e){this.contextMenus={},this.handleClick=t=>{var o;const s=this.contextMenus[t.id];s&&((o=s.onClick)===null||o===void 0||o.call(s,t.context,t.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return Ot(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:_e(e.icons),embed:e.embed&&it(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return Ot(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var j=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class In{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=t=>{const o=this.tools[t.id];if(o)if(o.onClick){const s=o.onClick(t.context,t.elementId);Promise.resolve(s).then(i=>{i&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:t.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:t.id})},this.handleToolActionClick=t=>{var o;const s=this.toolActions[t.id];s&&((o=s.onClick)===null||o===void 0||o.call(s,t.context,t.elementId))},this.handleToolModeClick=t=>{const o=this.toolModes[t.id];if(o)if(o.onClick){const s=o.onClick(t.context,t.elementId);Promise.resolve(s).then(i=>{i&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:t.context.activeTool,modeId:t.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:t.context.activeTool,modeId:t.id})},this.handleToolModeToolClick=t=>{const o=this.toolModes[t.id];if(o)if(o.onToolClick){const s=o.onToolClick(t.context,t.event);Promise.resolve(s).then(i=>{i&&t.event.target&&!t.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})})}else t.event.target&&!t.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})},this.handleToolModeToolDoubleClick=t=>{const o=this.toolModes[t.id];if(o)if(o.onToolDoubleClick){const s=o.onToolDoubleClick(t.context,t.event);Promise.resolve(s).then(i=>{i&&t.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})})}else t.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[t.event.target.id]})},this.handleToolModeToolDown=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolDown)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeToolMove=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolMove)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeToolUp=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolUp)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeToolDragStart=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolDragStart)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeToolDragMove=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolDragMove)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeToolDragEnd=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolDragEnd)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeToolDragCancel=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onToolDragCancel)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeKeyDown=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onKeyDown)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeKeyUp=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onKeyUp)===null||o===void 0||o.call(s,t.context,t.event))},this.handleToolModeActivate=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onActivate)===null||o===void 0||o.call(s,t.context))},this.handleToolModeDeactivate=t=>{var o;const s=this.toolModes[t.id];s&&((o=s.onDeactivate)===null||o===void 0||o.call(s,t.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return j(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:_e(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return j(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return j(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return j(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return t})}setMetadata(e,t){return j(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:t})})}createAction(e){return j(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:_e(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return j(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return j(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:_e(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return j(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,t){return j(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:t})})}}var ue=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class Mn{constructor(e){this.messageBus=e}open(e){return ue(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},it(e)))})}close(e){return ue(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return ue(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return t})}setWidth(e,t){return ue(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:t})})}getHeight(e){return ue(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return t})}setHeight(e,t){return ue(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:t})})}}var gt=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class wn{constructor(e){this.messageBus=e}open(e){return gt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},it(e)))})}close(e){return gt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var P=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class bn{constructor(e){this.messageBus=e}getWidth(){return P(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return P(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return P(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return P(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return P(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return P(this,void 0,void 0,function*(){const t=_e([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:t[0].icon})})}getTitle(){return P(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return P(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const t=o=>{e(o.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",t)}}}var Ln=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};et();class Dn{constructor(e){this.messageBus=e}startItemInteraction(e,t=!0){return Ln(this,void 0,void 0,function*(){const{id:o}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e,updateAttachments:t});let s=e;return[d=>{const[l,u]=st(s,d);return s=l,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:o,patches:u}),l},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:o})}]})}}var xn=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class Pn{constructor(e){this.messageBus=e}getPlayers(){return xn(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const t=o=>{e(o.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",t)}}}var He=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class Gn{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return He(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return He(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return He(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const t=o=>{e(o.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",t)}}onPermissionsChange(e){const t=o=>{e(o.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",t)}}}var kn=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class Un{constructor(e){this.messageBus=e}getTheme(){return kn(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const t=o=>{e(o.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",t),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",t)}}}var Tt=function(n,e,t,o){function s(i){return i instanceof t?i:new t(function(r){r(i)})}return new(t||(t=Promise))(function(i,r){function d(a){try{u(o.next(a))}catch(c){r(c)}}function l(a){try{u(o.throw(a))}catch(c){r(c)}}function u(a){a.done?i(a.value):s(a.value).then(d,l)}u((o=o.apply(n,e||[])).next())})};class $n{constructor(e){this.messageBus=e}uploadImages(e){return Tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e})})}uploadScenes(e){return Tt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e})})}}const Vn=typeof atob=="function",rt=typeof Buffer=="function",Bt=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const Hn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",jn=Array.prototype.slice.call(Hn),Te=(n=>{let e={};return n.forEach((t,o)=>e[t]=o),e})(jn),Yn=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Z=String.fromCharCode.bind(String),At=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),jt=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),Wn=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Fn=n=>{switch(n.length){case 4:var e=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),t=e-65536;return Z((t>>>10)+55296)+Z((t&1023)+56320);case 3:return Z((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return Z((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},Kn=n=>n.replace(Wn,Fn),zn=n=>{if(n=n.replace(/\s+/g,""),!Yn.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let e,t="",o,s;for(let i=0;i<n.length;)e=Te[n.charAt(i++)]<<18|Te[n.charAt(i++)]<<12|(o=Te[n.charAt(i++)])<<6|(s=Te[n.charAt(i++)]),t+=o===64?Z(e>>16&255):s===64?Z(e>>16&255,e>>8&255):Z(e>>16&255,e>>8&255,e&255);return t},Yt=Vn?n=>atob(jt(n)):rt?n=>Buffer.from(n,"base64").toString("binary"):zn,Xn=rt?n=>At(Buffer.from(n,"base64")):n=>At(Yt(n).split("").map(e=>e.charCodeAt(0))),qn=rt?n=>Buffer.from(n,"base64").toString("utf8"):Bt?n=>Bt.decode(Xn(n)):n=>Kn(Yt(n)),Jn=n=>jt(n.replace(/[-_]/g,e=>e=="-"?"+":"/")),Qn=n=>qn(Jn(n));function Zn(){const e=new URLSearchParams(window.location.search).get("obrref");let t="",o="";if(e){const i=Qn(e).split(" ");i.length===2&&(t=i[0],o=i[1])}return{origin:t,roomId:o}}var Ct;(function(n){n[n.MOVE=0]="MOVE",n[n.LINE=1]="LINE",n[n.QUAD=2]="QUAD",n[n.CONIC=3]="CONIC",n[n.CUBIC=4]="CUBIC",n[n.CLOSE=5]="CLOSE"})(Ct||(Ct={}));const Xe=Zn(),N=new dn(Xe.origin,Xe.roomId),eo=new Xt(N),to=new zt(N),no=new Pn(N),oo=new ln(N),so=new Sn(N),io=new Nn(N),ro=new In(N),ao=new Mn(N),uo=new wn(N),co=new bn(N),lo=new Dn(N),ho=new Gn(N),fo=new Un(N),mo=new $n(N),K={onReady:n=>{N.ready?n():N.once("OBR_READY",()=>n())},get isReady(){return N.ready},viewport:eo,player:to,party:no,notification:oo,scene:so,contextMenu:io,tool:ro,popover:ao,modal:uo,action:co,interaction:lo,room:ho,theme:fo,assets:mo,isAvailable:!!Xe.origin};function _o(n){let e=0;if(n.length===0)return e;for(let t=0;t<n.length;t++){const o=n.charCodeAt(t);e=(e<<5)-e+o,e&=e}return e}function yo(n){return`hsl(${(_o(n)%360+360)%360}, 70%, 60%)`}function Rt(n,e){const t=window.matchMedia("(prefers-color-scheme: dark)"),o=t.matches?"dark":"light",s=t.matches?"light":"dark";for(var i=0;i<e.styleSheets.length;i++)for(var r=0;r<e.styleSheets[i].cssRules.length;r++){let d=e.styleSheets[i].cssRules[r];d&&d.media&&d.media.mediaText.includes("prefers-color-scheme")&&(n.mode=="LIGHT"?(d.media.appendMedium(`(prefers-color-scheme: ${o})`),d.media.mediaText.includes(s)&&d.media.deleteMedium(`(prefers-color-scheme: ${s})`)):n.mode=="DARK"&&(d.media.appendMedium(`(prefers-color-scheme: ${s})`),d.media.mediaText.includes(o)&&d.media.deleteMedium(`(prefers-color-scheme: ${o})`)))}}class Re{}ut(Re,"EXTENSIONID","com.battle-system.calendar");document.querySelector("#app").innerHTML=`
<div id="floating-header">
  <button id="calendarButton" class="button-selected" (click)="toggleContent('calendar')">Calendar</button>
  <button (click)="toggleContent('months')">Months</button>
  <button (click)="toggleContent('days')">Days</button>
  <button (click)="toggleContent('moons')">Moons</button>
  <button (click)="toggleContent('import')">Import</button>
  <button id="generateCalendar">Generate</button>
</div>

<div id="calendar" class="content">
    <h2 id="titleLine"><div id="spellLevelContainer" style="display:none;"></div><div id="titleName">Calendar!</div><div id="profLevelContainer" style="display:none;"></div></h2>
    <div id="moonContainer"></div>
    <div id="calendarOutput"></div>
</div>

<div id="months" class="content" style="display:none;">
    <label for="calendarName">Calendar Name/Year:</label>
    <input type="text" id="calendarName" name="calendarName" value="Testers">
    </br>
    <label for="currentMonth">Current Month:</label>
    <input type="number" class="input-mini" id="currentMonth" name="currentMonth" value="1">
    </br>
    <label for="numMonths">Number of Months:</label>
    <input type="number" class="input-mini" id="numMonths" name="numMonths" min="1" value="12">
    <div id="monthInputContainer"></div>
</div>

<div id="days" class="content" style="display:none;">
    <label for="currentDay">Current Day:</label>
    <input type="number" class="input-mini" id="currentDay" name="currentDay" value="1">
    </br>
    <label for="daysPerWeek">Days per Week:</label>
    <input type="number" class="input-mini" id="daysPerWeek" name="daysPerWeek" min="1" value="7">
    <div id="dayNameInputContainer"></div>
        
    <input type="number" style="display: none;" class="input-mini" id="totalDaysInYear" name="totalDaysInYear" min="1" value="365">
</div>

<div id="moons" class="content" style="display:none;">
    <label for="numMoons">Number of Moons:</label>
    <input type="number" class="input-mini" id="numMoons" name="numMoons" min="1" value="1">
    <div id="moonInputContainer"></div>
</div>

<div id="import" class="content" style="display:none;">
    <label for="donjonJson">DonJon Calendar Importer:</label>
    </br>
    <textarea id="donjonJson" rows="20" style="width: 100%;"></textarea>
    </br>
    <button id="importDonJon">Import DonJon Calendar</button>
</div>
<div class="bottom-border"></div>
`;const je=document.getElementById("calendarName"),J=document.getElementById("daysPerWeek"),St=document.getElementById("monthInputContainer"),V=document.getElementById("numMonths"),Nt=document.getElementById("dayNameInputContainer"),It=document.getElementById("moonInputContainer"),he=document.getElementById("numMoons"),Eo=document.getElementById("generateCalendar"),po=document.getElementById("importDonJon"),Mt=document.getElementById("calendarOutput"),wt=document.getElementById("calendarButton"),vo=document.getElementById("generateCalendar"),Be=document.getElementById("titleName"),ee=document.getElementById("spellLevelContainer"),Le=document.createElement("div");let F=0;Le.textContent="SpellLevel: ";Le.classList.add("moon-phase-label");Le.style.marginTop="4px";ee==null||ee.appendChild(Le);const pe=document.createElement("input");pe.id="spellInput";pe.type="number";pe.classList.add("moon-mage-stuff");pe.onchange=n=>{switch(+n.target.value){case 0:F=0;break;case 1:F=0;break;case 2:F=2;break;case 3:F=4;break;case 4:F=6;break;case 5:F=8;break;default:F=8;break}const o=document.querySelectorAll(".moon-dc-label");for(const s of o){const i=+s.getAttribute("data-dc");s.textContent=`Spell DC: ${(i+F).toString()}`}};ee==null||ee.appendChild(pe);const te=document.getElementById("profLevelContainer"),De=document.createElement("div");De.textContent="Proficiency: ";De.classList.add("moon-phase-label");De.style.marginTop="4px";te==null||te.appendChild(De);const xe=document.createElement("input");xe.id="profInput";xe.type="number";xe.classList.add("moon-mage-stuff");te==null||te.appendChild(xe);const bt=document.getElementById("moonContainer"),G=document.getElementById("currentDay"),R=document.getElementById("currentMonth");K.onReady(async()=>{const n=await K.theme.getTheme();Rt(n,document),K.theme.onChange(h=>{Rt(h,document)});const e=await K.player.getRole(),o=(await K.room.getMetadata())[`${Re.EXTENSIONID}/saveData`];if(l(),r(),d(),o&&await B(o),e==="PLAYER"){document.getElementById("floating-header").style.display="none",document.getElementById("calendar").style.marginTop="0",K.room.onMetadataChange(async h=>{const f=h[`${Re.EXTENSIONID}/saveData`];f&&await B(f)});return}const s=document.querySelectorAll("#floating-header button"),i=document.querySelectorAll(".content");s.forEach(h=>{h.addEventListener("click",function(){var m;let f=(m=h.textContent)==null?void 0:m.toLowerCase();f==="generate"&&(f="calendar"),f&&(i.forEach(_=>{_.style.display=_.id===f?"block":"none"}),s.forEach(_=>{_.classList.remove("button-selected")}),h===vo?wt.classList.add("button-selected"):h.classList.add("button-selected"))})}),R.onchange=async()=>await E(),G.onchange=async()=>await E(),Eo.onclick=async()=>await a(),po.onclick=async()=>await B(),J.onchange=()=>d(),he.onchange=()=>l(),V.onchange=()=>r();function r(){St.innerHTML="";for(let h=1;h<=+V.value;h++){const f=document.createElement("div");f.innerHTML=`
            <label for="month${h}Name">Name ${h}:</label>
            <input type="text" id="month${h}Name" name="month${h}Name" value="Month${h}">
    
            <label for="month${h}Days">Days:</label>
            <input type="number" class="input-mini" id="month${h}Days" name="month${h}Days" min="1" value="30">
          `,St.appendChild(f)}}function d(){Nt.innerHTML="";for(let h=1;h<=+J.value;h++){const f=document.createElement("div");f.innerHTML=`
            <label for="day${h}Name">Day ${h} Name:</label>
            <input type="text" id="day${h}Name" name="day${h}Name" value="Day${h}">
          `,Nt.appendChild(f)}}function l(){It.innerHTML="";for(let h=1;h<=+he.value;h++){const f=document.createElement("div");f.innerHTML=`
            <label for="moon${h}Name">Name ${h}:</label>
            <input type="text" class="moon-input" id="moon${h}Name" name="moon${h}Name" value="Moon${h}">
    
            <label for="moon${h}Cycle">Cycle ${h} (days):</label>
            <input type="number" class="input-mini" id="moon${h}Cycle" name="moon${h}Cycle" min="1" value="30">
    
            <label for="moon${h}Shift">Shift ${h}:</label>
            <input type="number" class="input-mini" id="moon${h}Shift" name="moon${h}Shift" min="0" value="0">
          `,It.appendChild(f)}}function u(h,f,m){return document.getElementById(`${h}${f}${m}`).value}async function a(){const h=[],f=[];for(let O=1;O<=+V.value;O++){const b=u("month",O,"Name"),L=u("month",O,"Days");h.push(b),f.push(L)}const m=[];for(let O=1;O<=+J.value;O++){const b=u("day",O,"Name");m.push(b)}const _=document.createElement("div");_.classList.add("calendar-system-container");const y=document.createElement("button");y.title="Select Previous Day",y.classList.add("day-back-button"),y.style.background="url(./back-day.svg) no-repeat center center",y.style.backgroundSize="contain",y.onclick=async()=>{G.value=(+G.value-1).toString(),await E()};const v=document.createElement("button");v.title="Select Next Day",v.classList.add("day-forward-button"),v.style.background="url(./forward-day.svg) no-repeat center center",v.style.backgroundSize="contain",v.onclick=async()=>{G.value=(+G.value+1).toString(),await E()},Be.innerHTML="",e==="GM"&&Be.appendChild(y),Be.appendChild(document.createTextNode(je.value)),e==="GM"&&Be.appendChild(v);let A=1,C=!0;for(let O=0;O<+V.value;O++){const b=document.createElement("button");b.title="View previous Month",b.classList.add("mon-back-button"),b.style.background="url(./back-month.svg) no-repeat center center",b.style.backgroundSize="contain",b.onclick=()=>{let k=+R.value-1;k<1&&(k=+V.value),R.value=k.toString(),p()};const L=document.createElement("button");L.title="View next Month",L.classList.add("mon-forward-button"),L.style.background="url(./forward-month.svg) no-repeat center center",L.style.backgroundSize="contain",L.onclick=()=>{let k=+R.value+1;k>+V.value&&(k=1),R.value=k.toString(),p()};const I=document.createElement("table");I.classList.add("calendar-system"),I.id=`monthTable${O}`;const le=h[O]?h[O]:`Month ${(O+1).toString()}`,q=I.insertRow();q.classList.add("month-row");const W=q.insertCell();W.classList.add("month-header-cell"),W.appendChild(b),W.appendChild(document.createTextNode(le)),W.appendChild(L),W.colSpan=+J.value;const oe=I.insertRow();for(const k of m){const Pe=oe.insertCell();Pe.textContent=k,Pe.classList.add("day-header")}let se=A;for(let k=1;k<=+f[O];k++){if(C){I.insertRow();const Wt=I.rows[I.rows.length-1];for(let at=1;at<se;at++)Wt.insertCell();C=!1}else se===1&&I.insertRow();const ve=I.rows[I.rows.length-1].insertCell();ve.textContent=`${k}`,ve.setAttribute("data-month",(O+1).toString()),ve.setAttribute("data-day",k.toString()),ve.classList.add("day-cell"),se++,se>+J.value&&(se=1)}A=se,C=!0,_.appendChild(I)}Mt.innerHTML="",Mt.appendChild(_),await E()}function c(){const h=[];for(let y=1;y<=+J.value;y++){const v=u("day",y,"Name");h.push(v)}const f=[];for(let y=1;y<=+V.value;y++){const v=u("month",y,"Name"),A=u("month",y,"Days");f.push({Name:v,Days:A})}const m=[];for(let y=1;y<=+he.value;y++){const v=u("moon",y,"Name"),A=u("moon",y,"Cycle"),C=u("moon",y,"Shift");m.push({Name:v,Cycle:A,Shift:C})}return{NameYear:je.value,CurrentDay:G.value,CurrentMonth:R.value,NumberMonth:V.value,DaysPerWeek:J.value,NumberMoons:he.value,MoonSet:m,MonthSet:f,DaySet:h}}function p(){const h=document.querySelectorAll(".calendar-system");for(const f of h){const m=+R.value-1;f.id===`monthTable${m}`?f.style.display="table":f.style.display="none"}}async function E(){const h=u("month",+R.value,"Days");if(+G.value>+h){let y=+R.value+1;y>+V.value?(G.value="1",R.value="1"):(R.value=y.toString(),G.value="1")}else if(+G.value<1){let y=+R.value-1;if(y<1){const v=u("month",+V.value-1,"Days");G.value=v,R.value=V.value}else{const v=u("month",y,"Days");R.value=(+R.value-1).toString(),G.value=v}}document.querySelectorAll(".calendar-system td").forEach(y=>y.classList.remove("current-date"));const m=document.querySelector(`.calendar-system td[data-month="${R.value}"][data-day="${G.value}"]`);m&&m.classList.add("current-date"),p();const _=[];for(let y=1;y<=+he.value;y++){const v=u("moon",y,"Name"),A=u("moon",y,"Cycle"),C=u("moon",y,"Shift");_.push({name:v,cycle:A,shift:C})}bt.innerHTML="";for(const y of _){const v=T(+G.value,+y.cycle,+y.shift,y.name);bt.appendChild(v)}if(e==="GM"){const y=c();await K.room.setMetadata({[`${Re.EXTENSIONID}/saveData`]:y})}}function T(h,f,m,_){const v=(h+m-1)%f/f;let A,C,O;v<.0625||v>=.9375?(A="/new_moon.png",C="New Moon",O="20"):v<.1875?(A="/waxing_crescent.png",C="Waxing Crescent",O="15"):v<.3125?(A="/first_quarter.png",C="First Quarter",O="10"):v<.4375?(A="/waxing_gibbous.png",C="Waxing Gibbous",O="8"):v<.5625?(A="/full_moon.png",C="Full Moon",O="5"):v<.6875?(A="/waning_gibbous.png",C="Waning Gibbous",O="8"):v<.8125?(A="/third_quarter.png",C="Third Quarter",O="10"):(A="/waning_crescent.png",C="Waning Crescent",O="15");let b=yo(_);switch(_){case"Katamba":b="#000000";break;case"Yavash":b="#FF0000";break;case"Xibar":b="#739BD0";break}const L=document.createElement("div"),I=document.createElement("section");I.classList.add("moon-icon"),I.style.setProperty("--moon-color",b);const le=document.createElement("label");le.textContent=_,le.classList.add("moon-name-label");const q=document.createElement("label");q.textContent=`Spell DC: ${+O+F}`,q.setAttribute("data-dc",O),q.classList.add("moon-dc-label");const W=document.createElement("label");W.textContent=C,W.classList.add("moon-phase-label");const oe=document.createElement("img");return oe.src=A,oe.classList.add("moon-image"),oe.title=_,I.appendChild(oe),L.appendChild(W),L.appendChild(I),L.appendChild(le),(_==="Xibar"||_==="Katamba"||_==="Yavash")&&(L.appendChild(document.createElement("br")),L.appendChild(q),ee.style.display="block",te.style.display="block"),L}async function B(h){const f=document.getElementById("donjonJson").value;let m;try{h?(m=w(h),R.value=h.CurrentMonth,G.value=h.CurrentDay):m=JSON.parse(f),je.value=m.year?m.year:"Default Calendar Name",V.value=m.n_months?m.n_months:"12",r();for(let _=1;_<=m.n_months;_++)document.getElementById(`month${_}Name`).value=m.months[_-1]?m.months[_-1]:`DefaultMonth#${_}`,document.getElementById(`month${_}Days`).value=m.month_len[m.months[_-1]]?m.month_len[m.months[_-1]]:"28";document.getElementById("daysPerWeek").value=m.weekdays.length>0?m.weekdays.length:"7",d();for(let _=1;_<=m.weekdays.length;_++)document.getElementById(`day${_}Name`).value=m.weekdays[_-1]?m.weekdays[_-1]:`DefaultDay#${_}`;document.getElementById("numMoons").value=m.n_moons?m.n_moons:"2",l();for(let _=1;_<=m.n_moons;_++)document.getElementById(`moon${_}Name`).value=m.moons[_-1]?m.moons[_-1]:`DefaultMoon#${_}`,document.getElementById(`moon${_}Cycle`).value=m.lunar_cyc[m.moons[_-1]]?m.lunar_cyc[m.moons[_-1]]:"28",document.getElementById(`moon${_}Shift`).value=m.lunar_shf[m.moons[_-1]]?m.lunar_shf[m.moons[_-1]]:"0";document.getElementById("totalDaysInYear").value=m.year_len?m.year_len:"336",await a(),h||(wt.click(),await K.notification.show("Calendar Imported Successfully!","SUCCESS"))}catch(_){alert("Invalid Calendar Format."),console.error(_)}}function w(h){const f={};return f.year=h.NameYear||"Default Calendar Name",f.n_months=h.NumberMonth||"12",f.months=[],f.month_len={},h.MonthSet.forEach((m,_)=>{f.months[_]=m.Name||`DefaultMonth#${_+1}`,f.month_len[f.months[_]]=m.Days||"28"}),f.weekdays=h.DaySet||["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],f.weekdays.forEach((m,_)=>{f.weekdays[_]=m||`DefaultDay#${_+1}`}),f.n_moons=h.NumberMoons||"2",f.moons=[],f.lunar_cyc={},f.lunar_shf={},h.MoonSet.forEach((m,_)=>{f.moons[_]=m.Name||`DefaultMoon#${_+1}`,f.lunar_cyc[f.moons[_]]=m.Cycle||"28",f.lunar_shf[f.moons[_]]=m.Shift||"0"}),f.year_len=h.DaysPerWeek||"336",f}});
