import{C as T,O as M}from"./constants-P2LeYaIH.js";let j={};function me(s){let c=0;if(s.length===0)return c;for(let I=0;I<s.length;I++){const b=s.charCodeAt(I);c=(c<<5)-c+b,c&=c}return c}function ue(s){return`hsl(${(me(s)%360+360)%360}, 70%, 60%)`}function ye(s,c,I="CALENDAR"){const b=`${c}_${I}}`,C=j[b];if(C)if(C!==s){const D=new Date(s),d=new Date().getTime()-D.getTime(),S=60*1e3;return d>=S?!0:(j[b]=s,!1)}else return!0;else{const D=new Date(s),d=new Date().getTime()-D.getTime(),S=60*1e3;return d>=S?!0:(j[b]=s,!1)}}function F(s,c){const I=window.matchMedia("(prefers-color-scheme: dark)"),b=I.matches?"dark":"light",C=I.matches?"light":"dark";for(var D=0;D<c.styleSheets.length;D++)for(var N=0;N<c.styleSheets[D].cssRules.length;N++){let d=c.styleSheets[D].cssRules[N];d&&d.media&&d.media.mediaText.includes("prefers-color-scheme")&&(s.mode=="LIGHT"?(d.media.appendMedium(`(prefers-color-scheme: ${b})`),d.media.mediaText.includes(C)&&d.media.deleteMedium(`(prefers-color-scheme: ${C})`)):s.mode=="DARK"&&(d.media.appendMedium(`(prefers-color-scheme: ${C})`),d.media.mediaText.includes(b)&&d.media.deleteMedium(`(prefers-color-scheme: ${b})`)))}}function he(){const s=document.createElement("img");s.id="whatsNewButton",s.setAttribute("class","icon"),s.classList.add("clickable"),s.style.marginLeft="10px",s.style.cursor="pointer",s.setAttribute("title","Whats New?"),s.setAttribute("src","/info.svg"),s.onclick=async function(){try{localStorage.setItem(T.VERSION,"true"),s.classList.remove("whats-new-shine")}catch{}await M.modal.open({id:T.EXTENSIONWHATSNEW,url:"/bswhatsnew.html",height:500,width:350})};try{localStorage.getItem(T.VERSION)!=="true"&&s.classList.add("whats-new-shine")}catch{}return s}document.querySelector("#app").innerHTML=`
<div id="floating-header">
  <button id="calendarButton" class="button-selected" (click)="toggleContent('calendar')">Calendar</button>
  <button (click)="toggleContent('months')">Months</button>
  <button (click)="toggleContent('days')">Days</button>
  <button (click)="toggleContent('moons')">Moons</button>
  <button (click)="toggleContent('import')">Import</button>
  <button id="generateCalendar">Generate</button>
  <div id="whatsNew"></div>
</div>

<div id="calendar" class="content">
    <h2 id="titleLine"><div id="spellLevelContainer" style="display:none;"></div><div id="titleName">Calendar!</div><div id="profLevelContainer" style="display:none;"></div></h2>
    <div id="moonContainer"></div>
    <div id="calendarOutput"></div>
</div>

<div id="months" class="content" style="display:none;">
    <label for="calendarName">Calendar Name/Year:</label>
    <input type="text" id="calendarName" name="calendarName" value="Testers">
    </br>
    <label for="currentMonth">Current Month:</label>
    <input type="number" class="input-mini" id="currentMonth" name="currentMonth" value="1">
    </br>
    <label for="numMonths">Number of Months:</label>
    <input type="number" class="input-mini" id="numMonths" name="numMonths" min="1" value="12">
    <div id="monthInputContainer"></div>
</div>

<div id="days" class="content" style="display:none;">
    <label for="currentDay">Current Day:</label>
    <input type="number" class="input-mini" id="currentDay" name="currentDay" value="1">
    </br>
    <label for="daysPerWeek">Days per Week:</label>
    <input type="number" class="input-mini" id="daysPerWeek" name="daysPerWeek" min="1" value="7">
    <div id="dayNameInputContainer"></div>
        
    <input type="number" style="display: none;" class="input-mini" id="totalDaysInYear" name="totalDaysInYear" min="1" value="365">
</div>

<div id="moons" class="content" style="display:none;">
    <label for="numMoons">Number of Moons:</label>
    <input type="number" class="input-mini" id="numMoons" name="numMoons" min="1" value="1">
    <div id="moonInputContainer"></div>
</div>

<div id="import" class="content" style="display:none;">
    <label for="donjonJson">DonJon Calendar Importer:</label>
    </br>
    <textarea id="donjonJson" rows="20" style="width: 100%;"></textarea>
    </br>
    <button id="importDonJon">Import DonJon Calendar</button>
</div>
<div class="bottom-border"></div>
`;const z=document.getElementById("calendarName"),L=document.getElementById("daysPerWeek"),ee=document.getElementById("monthInputContainer"),w=document.getElementById("numMonths"),te=document.getElementById("dayNameInputContainer"),ne=document.getElementById("moonInputContainer"),W=document.getElementById("numMoons"),pe=document.getElementById("generateCalendar"),fe=document.getElementById("importDonJon"),ae=document.getElementById("calendarOutput"),oe=document.getElementById("calendarButton"),ge=document.getElementById("generateCalendar"),O=document.getElementById("titleName"),be=document.getElementById("whatsNew");be.appendChild(he());let B=1,le=1;const K=document.getElementById("spellLevelContainer"),J=document.createElement("div");let k=0;J.textContent="SpellLevel: ";J.classList.add("moon-phase-label");J.style.marginTop="4px";K?.appendChild(J);const H=document.createElement("input");H.id="spellInput";H.type="number";H.classList.add("moon-mage-stuff");H.onchange=s=>{switch(+s.target.value){case 0:k=0;break;case 1:k=0;break;case 2:k=2;break;case 3:k=4;break;case 4:k=6;break;case 5:k=8;break;default:k=8;break}const b=document.querySelectorAll(".moon-dc-label");for(const C of b){const D=+C.getAttribute("data-dc");C.textContent=`Spell DC: ${(D+k).toString()}`}};K?.appendChild(H);const Q=document.getElementById("profLevelContainer"),X=document.createElement("div");X.textContent="Proficiency: ";X.classList.add("moon-phase-label");X.style.marginTop="4px";Q?.appendChild(X);const q=document.createElement("input");q.id="profInput";q.type="number";q.classList.add("moon-mage-stuff");Q?.appendChild(q);const se=document.getElementById("moonContainer"),u=document.getElementById("currentDay"),f=document.getElementById("currentMonth");M.onReady(async()=>{const s=await M.theme.getTheme();F(s,document),M.theme.onChange(t=>{F(t,document)});const c=await M.player.getRole(),b=(await M.room.getMetadata())[`${T.EXTENSIONID}/saveData`];if(S(),N(),d(),b&&await V(b),c==="GM"&&(document.getElementById("calendar").style.height="94%"),c==="PLAYER"){document.getElementById("floating-header").style.display="none",document.getElementById("calendar").style.marginTop="0",document.getElementById("titleLine").style.marginTop="2px",M.room.onMetadataChange(async t=>{const a=t[`${T.EXTENSIONID}/saveData`];a&&await V(a)});return}M.room.onMetadataChange(async t=>{const a=t[`${T.OUTSIDEID}/data`];a&&(ye(a.Timestamp,"Outside","CALENDAR")||(u.value=(+u.value+ +a.Increment).toString(),await _()))});const C=document.querySelectorAll("#floating-header button"),D=document.querySelectorAll(".content");C.forEach(t=>{t.addEventListener("click",function(){let a=t.textContent?.toLowerCase();a==="generate"&&(a="calendar"),a&&(D.forEach(n=>{n.style.display=n.id===a?"block":"none"}),C.forEach(n=>{n.classList.remove("button-selected")}),t===ge?oe.classList.add("button-selected"):t.classList.add("button-selected"))})}),f.onchange=async()=>await _(),u.onchange=async()=>await _(),pe.onclick=async()=>await U(),fe.onclick=async()=>await V(),L.onchange=()=>d(),W.onchange=()=>S(),w.onchange=()=>N();function N(){ee.innerHTML="";for(let t=1;t<=+w.value;t++){const a=document.createElement("div");a.innerHTML=`
            <label for="month${t}Name">Name ${t}:</label>
            <input type="text" id="month${t}Name" name="month${t}Name" value="Month${t}">
    
            <label for="month${t}Days">Days:</label>
            <input type="number" class="input-mini" id="month${t}Days" name="month${t}Days" min="1" value="30">
          `,ee.appendChild(a)}}function d(){te.innerHTML="";for(let t=1;t<=+L.value;t++){const a=document.createElement("div");a.innerHTML=`
            <label for="day${t}Name">Day ${t} Name:</label>
            <input type="text" id="day${t}Name" name="day${t}Name" value="Day${t}">
          `,te.appendChild(a)}}function S(){ne.innerHTML="";for(let t=1;t<=+W.value;t++){const a=document.createElement("div");a.innerHTML=`
            <label for="moon${t}Name">Name ${t}:</label>
            <input type="text" class="moon-input" id="moon${t}Name" name="moon${t}Name" value="Moon${t}">
    
            <label for="moon${t}Cycle">Cycle ${t} (days):</label>
            <input type="number" class="input-mini" id="moon${t}Cycle" name="moon${t}Cycle" min="1" value="30">
    
            <label for="moon${t}Shift">Shift ${t}:</label>
            <input type="number" class="input-mini" id="moon${t}Shift" name="moon${t}Shift" min="0" value="0">
          `,ne.appendChild(a)}}function g(t,a,n){return document.getElementById(`${t}${a}${n}`).value}async function U(){const t=[],a=[];for(let r=1;r<=+w.value;r++){const y=g("month",r,"Name"),h=g("month",r,"Days");t.push(y),a.push(h)}const n=[];for(let r=1;r<=+L.value;r++){const y=g("day",r,"Name");n.push(y)}const o=document.createElement("div");o.classList.add("calendar-system-container");const e=document.createElement("button");e.title="Select Previous Day",e.classList.add("day-back-button"),e.classList.add("clickable"),e.style.background="url(./back-day.svg) no-repeat center center",e.style.backgroundSize="contain",e.onclick=async()=>{u.value=(+u.value-1).toString(),await _()};const l=document.createElement("button");l.title="Select Next Day",l.classList.add("day-forward-button"),l.classList.add("clickable"),l.style.background="url(./forward-day.svg) no-repeat center center",l.style.backgroundSize="contain",l.onclick=async()=>{u.value=(+u.value+1).toString(),await _()},O.innerHTML="",c==="GM"&&O.appendChild(e),O.appendChild(document.createTextNode(z.value)),c==="GM"&&O.appendChild(l);let i=1,m=!0;for(let r=0;r<+w.value;r++){const y=document.createElement("button");y.title="View previous Month",y.classList.add("mon-back-button"),y.classList.add("clickable"),y.style.background="url(./back-month.svg) no-repeat center center",y.style.backgroundSize="contain",y.onclick=()=>{let v=B-1;v<1&&(v=+w.value),B=v,G()};const h=document.createElement("button");h.title="View next Month",h.classList.add("mon-forward-button"),h.classList.add("clickable"),h.style.background="url(./forward-month.svg) no-repeat center center",h.style.backgroundSize="contain",h.onclick=async()=>{let v=B+1;v>+w.value&&(v=1),B=v,G()};const p=document.createElement("table");p.classList.add("calendar-system"),p.id=`monthTable${r}`;const R=t[r]?t[r]:`Month ${(r+1).toString()}`,$=p.insertRow();$.classList.add("month-row");const E=$.insertCell();E.classList.add("month-header-cell"),E.appendChild(y),E.appendChild(document.createTextNode(R)),E.appendChild(h),E.colSpan=+L.value;const x=p.insertRow();for(const v of n){const Y=x.insertCell();Y.textContent=v,Y.classList.add("day-header")}let A=i;for(let v=1;v<=+a[r];v++){if(m){p.insertRow();const de=p.rows[p.rows.length-1];for(let Z=1;Z<A;Z++)de.insertCell();m=!1}else A===1&&p.insertRow();const P=p.rows[p.rows.length-1].insertCell();P.textContent=`${v}`,P.setAttribute("data-month",(r+1).toString()),P.setAttribute("data-day",v.toString()),P.classList.add("day-cell"),A++,A>+L.value&&(A=1)}i=A,m=!0,o.appendChild(p)}ae.innerHTML="",ae.appendChild(o),B=+f.value,await _()}function re(){const t=[];for(let e=1;e<=+L.value;e++){const l=g("day",e,"Name");t.push(l)}const a=[];for(let e=1;e<=+w.value;e++){const l=g("month",e,"Name"),i=g("month",e,"Days");a.push({Name:l,Days:i})}const n=[];for(let e=1;e<=+W.value;e++){const l=g("moon",e,"Name"),i=g("moon",e,"Cycle"),m=g("moon",e,"Shift");n.push({Name:l,Cycle:i,Shift:m})}return{NameYear:z.value,CurrentDay:u.value,CurrentMonth:f.value,NumberMonth:w.value,DaysPerWeek:L.value,NumberMoons:W.value,MoonSet:n,MonthSet:a,DaySet:t}}function G(t=!1){const a=document.querySelectorAll(".calendar-system");let n=B!==+f.value?B:+f.value;t&&(n=+f.value);let o=le<n;for(const e of a)e.id===`monthTable${n-1}`?setTimeout(()=>{le=n,e.style.display="table",e.style.transform=o?"translateX(100%)":"translateX(-100%)",e.offsetHeight,e.style.transform="translateX(0%)",e.style.transition="transform 0.2s ease-in-out"},200):(e.style.transform=o?"translateX(-100%)":"translateX(100%)",e.style.transition="transform 0.2s ease-in-out",setTimeout(()=>{e.style.display="none"},200))}async function _(){const t=g("month",+f.value,"Days");if(+u.value>+t){let e=+f.value+1;e>+w.value?(u.value="1",f.value="1"):(f.value=e.toString(),u.value="1")}else if(+u.value<1){let e=+f.value-1;if(e<1){const l=g("month",+w.value-1,"Days");u.value=l,f.value=w.value}else{const l=g("month",e,"Days");f.value=(+f.value-1).toString(),u.value=l}}document.querySelectorAll(".calendar-system td").forEach(e=>e.classList.remove("current-date"));const n=document.querySelector(`.calendar-system td[data-month="${f.value}"][data-day="${u.value}"]`);n&&n.classList.add("current-date"),G(!0);const o=[];for(let e=1;e<=+W.value;e++){const l=g("moon",e,"Name"),i=g("moon",e,"Cycle"),m=g("moon",e,"Shift");o.push({name:l,cycle:i,shift:m})}se.innerHTML="";for(const e of o){const l=ce(+u.value,+e.cycle,+e.shift,e.name);se.appendChild(l)}if(c==="GM"){const e=re();await M.room.setMetadata({[`${T.EXTENSIONID}/saveData`]:e});const l=e?.MonthSet[+e.CurrentMonth-1]?.Name;await M.action.setBadgeText(`${l??e?.CurrentMonth}:${e?.CurrentDay}`)}}function ce(t,a,n,o){const l=(t+n-1)%a/a;let i,m,r;l<.0625||l>=.9375?(i="/new_moon.png",m="New Moon",r="20"):l<.1875?(i="/waxing_crescent.png",m="Waxing Crescent",r="15"):l<.3125?(i="/first_quarter.png",m="First Quarter",r="10"):l<.4375?(i="/waxing_gibbous.png",m="Waxing Gibbous",r="8"):l<.5625?(i="/full_moon.png",m="Full Moon",r="5"):l<.6875?(i="/waning_gibbous.png",m="Waning Gibbous",r="8"):l<.8125?(i="/third_quarter.png",m="Third Quarter",r="10"):(i="/waning_crescent.png",m="Waning Crescent",r="15");let y=ue(o);switch(o){case"Katamba":y="#000000";break;case"Yavash":y="#FF0000";break;case"Xibar":y="#739BD0";break}const h=document.createElement("div"),p=document.createElement("section");p.classList.add("moon-icon"),p.style.setProperty("--moon-color",y);const R=document.createElement("label");R.textContent=o,R.classList.add("moon-name-label");const $=document.createElement("label");$.textContent=`Spell DC: ${+r+k}`,$.setAttribute("data-dc",r),$.classList.add("moon-dc-label");const E=document.createElement("label");E.textContent=m,E.classList.add("moon-phase-label");const x=document.createElement("img");return x.src=i,x.classList.add("moon-image"),x.title=o,p.appendChild(x),h.appendChild(E),h.appendChild(p),h.appendChild(R),(o==="Xibar"||o==="Katamba"||o==="Yavash")&&(h.appendChild(document.createElement("br")),h.appendChild($),K.style.display="block",Q.style.display="block"),h}async function V(t){const a=document.getElementById("donjonJson").value;let n;try{t?(n=ie(t),f.value=t.CurrentMonth,u.value=t.CurrentDay):n=JSON.parse(a),z.value=n.year?n.year:"Default Calendar Name",w.value=n.n_months?n.n_months:"12",N();for(let e=1;e<=n.n_months;e++)document.getElementById(`month${e}Name`).value=n.months[e-1]?n.months[e-1]:`DefaultMonth#${e}`,document.getElementById(`month${e}Days`).value=n.month_len[n.months[e-1]]?n.month_len[n.months[e-1]]:"28";document.getElementById("daysPerWeek").value=n.weekdays.length>0?n.weekdays.length:"7",d();for(let e=1;e<=n.weekdays.length;e++)document.getElementById(`day${e}Name`).value=n.weekdays[e-1]?n.weekdays[e-1]:`DefaultDay#${e}`;document.getElementById("numMoons").value=n.n_moons?n.n_moons:"2",S();for(let e=1;e<=n.n_moons;e++)document.getElementById(`moon${e}Name`).value=n.moons[e-1]?n.moons[e-1]:`DefaultMoon#${e}`,document.getElementById(`moon${e}Cycle`).value=n.lunar_cyc[n.moons[e-1]]?n.lunar_cyc[n.moons[e-1]]:"28",document.getElementById(`moon${e}Shift`).value=n.lunar_shf[n.moons[e-1]]?n.lunar_shf[n.moons[e-1]]:"0";document.getElementById("totalDaysInYear").value=n.year_len?n.year_len:"336",await U();const o=t?.MonthSet[+t.CurrentMonth-1]?.Name;await M.action.setBadgeText(`${o??t?.CurrentMonth}:${t?.CurrentDay}`),t||(oe.click(),await M.notification.show("Calendar Imported Successfully!","SUCCESS"))}catch(o){alert("Invalid Calendar Format."),console.error(o)}}function ie(t){const a={};return a.year=t.NameYear||"Default Calendar Name",a.n_months=t.NumberMonth||"12",a.months=[],a.month_len={},t.MonthSet.forEach((n,o)=>{a.months[o]=n.Name||`DefaultMonth#${o+1}`,a.month_len[a.months[o]]=n.Days||"28"}),a.weekdays=t.DaySet||["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],a.weekdays.forEach((n,o)=>{a.weekdays[o]=n||`DefaultDay#${o+1}`}),a.n_moons=t.NumberMoons||"2",a.moons=[],a.lunar_cyc={},a.lunar_shf={},t.MoonSet.forEach((n,o)=>{a.moons[o]=n.Name||`DefaultMoon#${o+1}`,a.lunar_cyc[a.moons[o]]=n.Cycle||"28",a.lunar_shf[a.moons[o]]=n.Shift||"0"}),a.year_len=t.DaysPerWeek||"336",a}});
